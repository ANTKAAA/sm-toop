<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المستقبل للتسويق العقاري - الوساطة العقارية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* إعلان متحرك */
        .moving-announcement {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(45deg, #4f46e5, #7c3aed, #ec4899);
            color: white;
            padding: 8px 0;
            z-index: 1000;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .announcement-text {
            display: inline-block;
            white-space: nowrap;
            animation: scroll-right 20s linear infinite;
            font-weight: bold;
            font-size: 14px;
        }
        
        @keyframes scroll-right {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100vw);
            }
        }
        
        /* تعديل المحتوى ليبدأ تحت الإعلان */
        body {
            padding-top: 40px;
        }
        .property-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        .price-warning {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            border-right: 4px solid #f59e0b;
        }
        .map-container {
            height: 300px;
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            border: 2px dashed #0288d1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }
        .admin-tab {
            display: none;
        }
        .admin-tab.active {
            display: block;
        }
        .admin-tab-btn.active {
            background-color: #7c3aed !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <!-- إعلان متحرك -->
    <div class="moving-announcement">
        <div class="announcement-text">
            🌟 صلِّ على محمد ﷺ 🌟 تم إدارة التسويق للموقع من TopMarketing 🌟 للتواصل: 01091020887 🌟 المستقبل للتسويق العقاري - منصتك الموثوقة 🌟
        </div>
    </div>
    
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <h1 class="text-4xl font-bold text-blue-800" onclick="adminClickCount()" style="cursor: pointer;">🏠 المستقبل للتسويق العقاري</h1>
                <nav class="flex gap-4">
                    <button onclick="showSection('home')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">بيع أو شراء عقار</button>
                    <button onclick="showSection('listings')" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">العقارات المتاحة</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Home Section -->
    <main id="home-section" class="container mx-auto px-4 py-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">مرحباً بك في المستقبل للتسويق العقاري</h2>
            <p class="text-xl text-gray-600">منصتك الموثوقة للوساطة العقارية</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto mb-12">
            <!-- Seller Section -->
            <div class="property-card bg-white rounded-2xl shadow-xl p-8 border-t-4 border-green-500">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🏡</div>
                    <h3 class="text-2xl font-bold text-green-700 mb-2">بائع عقار</h3>
                    <p class="text-gray-600">قم ببيع عقارك بأفضل الأسعار</p>
                </div>
                <button onclick="showSellerForm()" class="w-full bg-green-600 text-white py-4 rounded-xl text-lg font-semibold hover:bg-green-700 transition-colors">
                    ابدأ بيع عقارك الآن
                </button>
            </div>

            <!-- Buyer Section -->
            <div class="property-card bg-white rounded-2xl shadow-xl p-8 border-t-4 border-blue-500">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🔍</div>
                    <h3 class="text-2xl font-bold text-blue-700 mb-2">شاري عقار</h3>
                    <p class="text-gray-600">ابحث عن العقار المناسب لك</p>
                </div>
                <button onclick="showBuyerForm()" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition-colors">
                    ابحث عن عقارك المثالي
                </button>
            </div>
        </div>

        <!-- Contracting Services Section -->
        <div class="max-w-6xl mx-auto" id="contracting-services-section">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-orange-700 mb-4">🏗️ خدمات التشطيب والمقاولات</h2>
                <p class="text-xl text-gray-600">خدمات متكاملة للتصميم والتشطيب والمقاولات</p>
            </div>
            
            <div id="home-services-grid" class="grid md:grid-cols-3 gap-6">
                <!-- Services will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Seller Form Section -->
    <div id="seller-section" class="form-section container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-3xl font-bold text-green-700 mb-8 text-center">نموذج بيع العقار</h2>
            
            <form id="seller-form" onsubmit="submitSellerForm(event)">
                <!-- Property Type Selection -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">نوع العقار</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button type="button" onclick="selectPropertyType('apartment')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏠</div>
                            <div class="font-semibold">شقة</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('house')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏘️</div>
                            <div class="font-semibold">بيت</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('land')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🌾</div>
                            <div class="font-semibold">أرض</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('shop')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏪</div>
                            <div class="font-semibold">محل</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('office')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏢</div>
                            <div class="font-semibold">مكتب تجاري</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('villa')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏰</div>
                            <div class="font-semibold">فيلا</div>
                        </button>
                        <button type="button" onclick="selectPropertyType('building-land')" class="property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors">
                            <div class="text-2xl mb-2">🏗️</div>
                            <div class="font-semibold">أرض مباني</div>
                        </button>
                    </div>
                </div>

                <!-- Location Selection -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">الموقع</label>
                    <select id="seller-location" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        <option value="">اختر الموقع</option>
                        <option value="damanhour">دمنهور</option>
                        <option value="kom-hamada">كوم حمادة</option>
                        <option value="itay">إيتاي البارود</option>
                        <option value="delengat">الدلنجات</option>
                    </select>
                </div>

                <!-- Map Location -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">تحديد موقع العقار على الخريطة</label>
                    <div class="bg-gray-50 p-4 rounded-lg border-2 border-gray-300">
                        <div class="mb-4">
                            <input type="text" id="map-location" placeholder="اكتب اسم المكان بالتفصيل (مثال: شارع الجمهورية، كوم حمادة)" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                        
                        <!-- Map Selection Buttons -->
                        <div class="mb-4 flex gap-2 flex-wrap">
                            <button type="button" onclick="showMap('damanhour')" class="map-area-btn text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">خريطة دمنهور</button>
                            <button type="button" onclick="showMap('kom-hamada')" class="map-area-btn text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">خريطة كوم حمادة</button>
                            <button type="button" onclick="showMap('itay')" class="map-area-btn text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">خريطة إيتاي البارود</button>
                            <button type="button" onclick="showMap('delengat')" class="map-area-btn text-sm bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">خريطة الدلنجات</button>
                        </div>
                        
                        <!-- Interactive Maps Container -->
                        <div id="map-container" class="h-96 bg-white border-2 border-gray-300 rounded-lg relative overflow-hidden">
                            <div id="default-map-message" class="w-full h-full bg-gradient-to-br from-green-100 to-blue-100 flex items-center justify-center">
                                <div class="text-center p-6">
                                    <div class="text-6xl mb-4">🗺️</div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">خرائط تفاعلية للمناطق</h3>
                                    <p class="text-gray-600 mb-4">اختر المنطقة من الأزرار أعلاه لعرض الخريطة وتحديد موقع العقار</p>
                                    <p class="text-sm text-blue-600">🎯 يمكنك النقر على الخريطة لتحديد الموقع بدقة</p>
                                </div>
                            </div>
                            
                            <!-- Damanhour Interactive Map -->
                            <div id="damanhour-map" class="map-iframe hidden w-full h-full bg-gradient-to-br from-blue-100 to-green-100 relative overflow-y-auto">
                                <div class="absolute inset-0 flex items-center justify-center p-4">
                                    <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-blue-300 text-center max-w-2xl w-full max-h-full overflow-y-auto">
                                        <div class="text-4xl mb-3">📍</div>
                                        <h4 class="text-xl font-bold text-blue-800 mb-2">خريطة دمنهور</h4>
                                        <p class="text-gray-700 mb-4">المركز الرئيسي لمحافظة البحيرة - اختر المنطقة المحددة</p>
                                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm max-h-80 overflow-y-auto">
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - وسط البلد')">وسط البلد</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع الجمهورية')">شارع الجمهورية</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - المحطة')">منطقة المحطة</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - الجامعة')">منطقة الجامعة</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع البحر')">شارع البحر</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع التحرير')">شارع التحرير</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع سعد زغلول')">شارع سعد زغلول</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع الشهداء')">شارع الشهداء</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع الجيش')">شارع الجيش</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع النصر')">شارع النصر</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة الكورنيش')">منطقة الكورنيش</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - حي الزهور')">حي الزهور</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - حي السلام')">حي السلام</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - حي النصر')">حي النصر</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة المستشفى العام')">منطقة المستشفى العام</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة البريد')">منطقة البريد</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة المحكمة')">منطقة المحكمة</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة الديوان العام')">منطقة الديوان العام</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - شارع المدارس')">شارع المدارس</div>
                                            <div class="bg-blue-50 p-2 rounded cursor-pointer hover:bg-blue-100 transition-colors" onclick="selectMapLocation('دمنهور - منطقة السوق القديم')">منطقة السوق القديم</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-3">انقر على المنطقة لتحديدها بدقة</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Kom Hamada Interactive Map -->
                            <div id="kom-hamada-map" class="map-iframe hidden w-full h-full bg-gradient-to-br from-green-100 to-blue-100 relative overflow-y-auto">
                                <div class="absolute inset-0 flex items-center justify-center p-4">
                                    <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-green-300 text-center max-w-2xl w-full max-h-full overflow-y-auto">
                                        <div class="text-4xl mb-3">📍</div>
                                        <h4 class="text-xl font-bold text-green-800 mb-2">خريطة كوم حمادة</h4>
                                        <p class="text-gray-700 mb-4">منطقة حيوية ونشطة - اختر المنطقة المحددة</p>
                                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm max-h-80 overflow-y-auto">
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع سيدي خلف')">شارع سيدي خلف</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - وسط البلد')">وسط البلد</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - المحطة')">منطقة المحطة</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - الشارع الجديد')">الشارع الجديد</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع الجمهورية')">شارع الجمهورية</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع النيل')">شارع النيل</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع الثورة')">شارع الثورة</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع المدرسة')">شارع المدرسة</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع الشهداء')">شارع الشهداء</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع السلام')">شارع السلام</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة الجامع الكبير')">منطقة الجامع الكبير</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة السوق')">منطقة السوق</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة البريد')">منطقة البريد</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة الوحدة الصحية')">منطقة الوحدة الصحية</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - حي الزراعة')">حي الزراعة</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - حي الشباب')">حي الشباب</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة المدارس')">منطقة المدارس</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة الكوبري')">منطقة الكوبري</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - شارع الترعة')">شارع الترعة</div>
                                            <div class="bg-green-50 p-2 rounded cursor-pointer hover:bg-green-100 transition-colors" onclick="selectMapLocation('كوم حمادة - منطقة الجمعية التعاونية')">منطقة الجمعية التعاونية</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-3">انقر على المنطقة لتحديدها بدقة</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Itay Barud Interactive Map -->
                            <div id="itay-map" class="map-iframe hidden w-full h-full bg-gradient-to-br from-purple-100 to-blue-100 relative overflow-y-auto">
                                <div class="absolute inset-0 flex items-center justify-center p-4">
                                    <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-purple-300 text-center max-w-2xl w-full max-h-full overflow-y-auto">
                                        <div class="text-4xl mb-3">📍</div>
                                        <h4 class="text-xl font-bold text-purple-800 mb-2">خريطة إيتاي البارود</h4>
                                        <p class="text-gray-700 mb-4">منطقة سكنية مميزة - اختر المنطقة المحددة</p>
                                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm max-h-80 overflow-y-auto">
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - وسط البلد')">وسط البلد</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع الجمهورية')">شارع الجمهورية</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - المحطة')">منطقة المحطة</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - الحي الجديد')">الحي الجديد</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع النيل')">شارع النيل</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع السلام')">شارع السلام</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع الشهداء')">شارع الشهداء</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع المدرسة')">شارع المدرسة</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - منطقة السوق')">منطقة السوق</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - منطقة البريد')">منطقة البريد</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - منطقة الوحدة الصحية')">منطقة الوحدة الصحية</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - حي الزراعة')">حي الزراعة</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - منطقة الجامع')">منطقة الجامع</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - شارع الترعة')">شارع الترعة</div>
                                            <div class="bg-purple-50 p-2 rounded cursor-pointer hover:bg-purple-100 transition-colors" onclick="selectMapLocation('إيتاي البارود - منطقة المدارس')">منطقة المدارس</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-3">انقر على المنطقة لتحديدها بدقة</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Delengat Interactive Map -->
                            <div id="delengat-map" class="map-iframe hidden w-full h-full bg-gradient-to-br from-orange-100 to-yellow-100 relative overflow-y-auto">
                                <div class="absolute inset-0 flex items-center justify-center p-4">
                                    <div class="bg-white rounded-xl p-6 shadow-lg border-2 border-orange-300 text-center max-w-2xl w-full max-h-full overflow-y-auto">
                                        <div class="text-4xl mb-3">📍</div>
                                        <h4 class="text-xl font-bold text-orange-800 mb-2">خريطة الدلنجات</h4>
                                        <p class="text-gray-700 mb-4">منطقة هادئة ومناسبة للعائلات - اختر المنطقة المحددة</p>
                                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm max-h-80 overflow-y-auto">
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - وسط البلد')">وسط البلد</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - شارع الجمهورية')">شارع الجمهورية</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - المحطة')">منطقة المحطة</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - الحي السكني')">الحي السكني</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - شارع النيل')">شارع النيل</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - شارع السلام')">شارع السلام</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - شارع الشهداء')">شارع الشهداء</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة السوق')">منطقة السوق</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة البريد')">منطقة البريد</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة الوحدة الصحية')">منطقة الوحدة الصحية</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة المدارس')">منطقة المدارس</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - حي الزراعة')">حي الزراعة</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة الجامع')">منطقة الجامع</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - شارع الترعة')">شارع الترعة</div>
                                            <div class="bg-orange-50 p-2 rounded cursor-pointer hover:bg-orange-100 transition-colors" onclick="selectMapLocation('الدلنجات - منطقة الجمعية التعاونية')">منطقة الجمعية التعاونية</div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-3">انقر على المنطقة لتحديدها بدقة</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div id="selected-area-display" class="bg-white rounded-lg p-3 border-2 border-green-300 hidden">
                                <p class="text-green-600 font-semibold">📍 المنطقة المحددة: <span id="area-name"></span></p>
                                <p class="text-sm text-gray-600 mt-1">يمكنك الآن النقر على الخريطة لتحديد الموقع بدقة أكبر</p>
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <p class="text-xs text-gray-600">💡 اختر المنطقة لعرض خريطة جوجل ماب التفاعلية</p>
                            <div id="selected-coordinates" class="text-xs text-green-600 mt-1 hidden">
                                <!-- Selected coordinates will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Property Forms -->
                <div id="property-details">
                    <!-- Forms will be inserted here based on property type -->
                </div>

                <!-- Contact Information -->
                <div class="mb-8 bg-yellow-50 p-6 rounded-lg border-2 border-yellow-200">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">معلومات التواصل</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الاسم</label>
                            <input type="text" id="seller-name" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                            <input type="tel" id="seller-whatsapp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="01xxxxxxxxx" required>
                            <p class="text-sm text-red-600 mt-1">⚠️ يجب أن يكون الرقم متاح على الواتساب للتواصل السريع</p>
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 text-white py-4 rounded-xl text-lg font-semibold hover:bg-green-700 transition-colors">
                    تسجيل العقار للبيع
                </button>
            </form>
        </div>
    </div>

    <!-- Buyer Form Section -->
    <div id="buyer-section" class="form-section container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-3xl font-bold text-blue-700 mb-8 text-center">نموذج البحث عن عقار</h2>
            
            <form id="buyer-form" onsubmit="submitBuyerForm(event)">
                <!-- Property Type Selection -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">نوع العقار المطلوب</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <button type="button" onclick="selectBuyerPropertyType('apartment')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🏠</div>
                            <div class="font-semibold">شقة</div>
                        </button>
                        <button type="button" onclick="selectBuyerPropertyType('house')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🏘️</div>
                            <div class="font-semibold">بيت</div>
                        </button>
                        <button type="button" onclick="selectBuyerPropertyType('land')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🌾</div>
                            <div class="font-semibold">أرض</div>
                        </button>
                        <button type="button" onclick="selectBuyerPropertyType('shop')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🏪</div>
                            <div class="font-semibold">محل</div>
                        </button>
                        <button type="button" onclick="selectBuyerPropertyType('office')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🏢</div>
                            <div class="font-semibold">مكتب</div>
                        </button>
                        <button type="button" onclick="selectBuyerPropertyType('villa')" class="buyer-property-type-btn p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div class="text-2xl mb-2">🏰</div>
                            <div class="font-semibold">فيلا</div>
                        </button>
                    </div>
                </div>

                <!-- Location Selection -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">المنطقة المطلوبة</label>
                    <select id="buyer-location" onchange="updatePriceRange()" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                        <option value="">اختر المنطقة</option>
                        <option value="damanhour">دمنهور</option>
                        <option value="kom-hamada">كوم حمادة</option>
                        <option value="itay">إيتاي البارود</option>
                        <option value="delengat">الدلنجات</option>
                    </select>
                    <div id="price-range-info" class="mt-4 p-4 bg-blue-50 rounded-lg hidden">
                        <p class="text-sm text-blue-800 font-semibold">💡 الأسعار تتحدد حسب المساحة والموقع والمباني (حديثة أم قديمة) ومستوى التشطيب</p>
                    </div>
                </div>

                <!-- Budget -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">الميزانية المتاحة</label>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الحد الأدنى</label>
                            <select class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="900000">900,000 جنيه (الحد الأدنى)</option>
                                <option value="1000000">1,000,000 جنيه</option>
                                <option value="1500000">1,500,000 جنيه</option>
                                <option value="2000000">2,000,000 جنيه</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الحد الأقصى</label>
                            <input type="number" min="900000" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="أدخل المبلغ الأقصى">
                        </div>
                    </div>
                </div>

                <!-- Property Requirements -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">المواصفات المطلوبة</label>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة المطلوبة (متر مربع)</label>
                            <input type="number" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="مثال: 120">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الأدوار</label>
                            <select class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">غير محدد</option>
                                <option value="1">دور واحد</option>
                                <option value="2">دورين</option>
                                <option value="3">ثلاثة أدوار</option>
                                <option value="4+">أكثر من ثلاثة أدوار</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مستوى التشطيب</label>
                            <select class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="">غير محدد</option>
                                <option value="finished">متشطب كامل</option>
                                <option value="semi-finished">نصف تشطيب</option>
                                <option value="unfinished">على الطوبة</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة المباني</label>
                            <input type="number" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="مثال: 2020">
                        </div>
                    </div>
                </div>

                <!-- Additional Requirements -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">المتطلبات الإضافية</label>
                    <div class="grid md:grid-cols-3 gap-4">
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>أسانسير</span>
                        </label>
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>حديقة</span>
                        </label>
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>أمن وحراسة</span>
                        </label>
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>شارع حيوي</span>
                        </label>
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>منطقة تجارية</span>
                        </label>
                        <label class="flex items-center space-x-2 space-x-reverse">
                            <input type="checkbox" class="w-5 h-5 text-blue-600">
                            <span>مكان عمومي</span>
                        </label>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">ملاحظات إضافية</label>
                    <textarea class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none h-32" placeholder="اكتب أي متطلبات أو ملاحظات إضافية..."></textarea>
                </div>

                <!-- Contact Information -->
                <div class="mb-8 bg-yellow-50 p-6 rounded-lg border-2 border-yellow-200">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">معلومات التواصل</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الاسم</label>
                            <input type="text" id="buyer-name" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                            <input type="tel" id="buyer-whatsapp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="01xxxxxxxxx" required>
                            <p class="text-sm text-red-600 mt-1">⚠️ يجب أن يكون الرقم متاح على الواتساب للتواصل السريع</p>
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition-colors">
                    تسجيل طلب البحث
                </button>
            </form>
        </div>
    </div>

    <!-- Listings Section -->
    <div id="listings-section" class="form-section container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">العقارات المتاحة حالياً</h2>
            
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <!-- For Sale Properties -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-2xl font-bold text-green-700 mb-6 text-center">🏠 عقارات للبيع</h3>
                    <div id="sale-listings" class="space-y-4">
                        <!-- Sample listing -->
                        <div class="border-2 border-green-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg text-gray-800">شقة للبيع</h4>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">للبيع</span>
                            </div>
                            <p class="text-gray-600 mb-2">📍 كوم حمادة - شارع سيدي خلف</p>
                            <p class="text-gray-600 mb-2">📐 المساحة: 100 متر مربع</p>
                            <p class="text-gray-600 mb-2">🏠 3 غرف وصالة ومطبخ</p>
                            <p class="text-gray-600 mb-2">🏗️ مباني 2020 - كاملة العدادات</p>
                            <div class="flex justify-between items-center mt-4">
                                <div>
                                    <p class="text-sm text-gray-500">سعر المتر: 14,000 جنيه</p>
                                    <p class="text-xl font-bold text-green-600">السعر الكلي: 1,400,000 جنيه</p>
                                </div>
                                <button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">تواصل</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wanted Properties -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-2xl font-bold text-blue-700 mb-6 text-center">🔍 طلبات شراء</h3>
                    <div id="wanted-listings" class="space-y-4">
                        <!-- Sample wanted listing -->
                        <div class="border-2 border-blue-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-lg text-gray-800">مطلوب بيت</h4>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">مطلوب</span>
                            </div>
                            <p class="text-gray-600 mb-2">📍 كوم حمادة</p>
                            <p class="text-gray-600 mb-2">📐 المساحة: 150 متر مربع</p>
                            <p class="text-gray-600 mb-2">🏠 أرضي ودورين</p>
                            <div class="flex justify-between items-center mt-4">
                                <div>
                                    <p class="text-xl font-bold text-blue-600">الميزانية: 2,000,000 - 2,500,000 جنيه</p>
                                </div>
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">تواصل</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Section -->
    <div id="admin-login-section" class="form-section container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">🔐</div>
                <h2 class="text-3xl font-bold text-purple-700 mb-2">دخول الإدارة</h2>
                <p class="text-gray-600">يرجى إدخال بيانات الدخول للوصول إلى لوحة التحكم</p>
            </div>
            
            <form id="admin-login-form" onsubmit="adminLogin(event)">
                <div class="mb-6">
                    <label class="block text-lg font-semibold text-gray-700 mb-2">اسم المستخدم</label>
                    <input type="text" id="admin-username" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                </div>
                
                <div class="mb-8">
                    <label class="block text-lg font-semibold text-gray-700 mb-2">كلمة المرور</label>
                    <input type="password" id="admin-password" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                </div>
                
                <button type="submit" class="w-full bg-purple-600 text-white py-4 rounded-xl text-lg font-semibold hover:bg-purple-700 transition-colors">
                    دخول لوحة التحكم
                </button>
            </form>
            
            <div class="text-center mt-6">
                <button onclick="showSection('home')" class="text-purple-600 hover:text-purple-800 transition-colors">العودة للرئيسية</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Section -->
    <div id="admin-dashboard-section" class="form-section">
        <!-- Admin Header -->
        <div class="bg-purple-700 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold">🏠 لوحة تحكم المستقبل للتسويق العقاري</h1>
                    <div class="flex items-center gap-4">
                        <span id="admin-welcome" class="text-purple-200"></span>
                        <button onclick="adminLogout()" class="bg-purple-800 hover:bg-purple-900 px-4 py-2 rounded-lg transition-colors">تسجيل الخروج</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <!-- Admin Navigation -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
                <div class="flex flex-wrap gap-3 justify-center">
                    <button onclick="showAdminTab('registrations')" class="admin-tab-btn active bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">🏠 العقارات</button>
                    <button onclick="showAdminTab('search')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">🔍 البحث المتقدم</button>
                    <button onclick="showAdminTab('matching')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">🤝 نظام التوفيق</button>
                    <button onclick="showAdminTab('commission')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">💰 حساب العمولة</button>
                    <button onclick="showAdminTab('inquiries')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">📞 الاستعلامات</button>
                    <button onclick="showAdminTab('contracting')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">🏗️ طلبات الخدمات</button>
                    <button onclick="showAdminTab('contracting-clients')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">👷 عملاء المقاولات</button>
                    <button onclick="showAdminTab('services')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">⚙️ إدارة الخدمات</button>
                    <button onclick="showAdminTab('admins')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">👥 إدارة المديرين</button>
                    <button onclick="showAdminTab('statistics')" class="admin-tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm">📊 الإحصائيات</button>
                </div>
            </div>

            <!-- Notifications Bell -->
            <div id="notification-bell" class="fixed top-4 left-4 z-50">
                <button onclick="showNotifications()" class="relative bg-red-500 text-white p-3 rounded-full shadow-lg hover:bg-red-600 transition-colors">
                    🔔
                    <span id="notification-count" class="absolute -top-2 -right-2 bg-yellow-400 text-black text-xs font-bold px-2 py-1 rounded-full hidden">0</span>
                </button>
            </div>

            <!-- Advanced Search Tab -->
            <div id="admin-search-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-blue-700 mb-6">🔍 البحث المتقدم بالمناطق</h3>
                    
                    <!-- Location Search Buttons -->
                    <div class="grid md:grid-cols-4 gap-4 mb-8">
                        <button onclick="searchByLocation('damanhour')" class="location-search-btn bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 transition-colors">
                            <div class="text-2xl mb-2">🏙️</div>
                            <div class="font-bold">دمنهور</div>
                            <div class="text-sm mt-1" id="damanhour-count">0 عقار</div>
                        </button>
                        <button onclick="searchByLocation('kom-hamada')" class="location-search-btn bg-green-500 text-white p-4 rounded-xl hover:bg-green-600 transition-colors">
                            <div class="text-2xl mb-2">🌿</div>
                            <div class="font-bold">كوم حمادة</div>
                            <div class="text-sm mt-1" id="kom-hamada-count">0 عقار</div>
                        </button>
                        <button onclick="searchByLocation('itay')" class="location-search-btn bg-purple-500 text-white p-4 rounded-xl hover:bg-purple-600 transition-colors">
                            <div class="text-2xl mb-2">🏘️</div>
                            <div class="font-bold">إيتاي البارود</div>
                            <div class="text-sm mt-1" id="itay-count">0 عقار</div>
                        </button>
                        <button onclick="searchByLocation('delengat')" class="location-search-btn bg-orange-500 text-white p-4 rounded-xl hover:bg-orange-600 transition-colors">
                            <div class="text-2xl mb-2">🌾</div>
                            <div class="font-bold">الدلنجات</div>
                            <div class="text-sm mt-1" id="delengat-count">0 عقار</div>
                        </button>
                    </div>
                    
                    <!-- Advanced Filters -->
                    <div class="bg-gray-50 p-6 rounded-xl mb-6">
                        <h4 class="text-lg font-bold text-gray-700 mb-4">فلاتر البحث المتقدم</h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نوع العقار</label>
                                <select id="search-property-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                    <option value="">جميع الأنواع</option>
                                    <option value="apartment">شقة</option>
                                    <option value="house">بيت</option>
                                    <option value="land">أرض</option>
                                    <option value="shop">محل</option>
                                    <option value="office">مكتب</option>
                                    <option value="villa">فيلا</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نوع العميل</label>
                                <select id="search-client-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                    <option value="">بائع وشاري</option>
                                    <option value="seller">بائع فقط</option>
                                    <option value="buyer">شاري فقط</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المنطقة</label>
                                <select id="search-location-filter" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                    <option value="">جميع المناطق</option>
                                    <option value="damanhour">دمنهور</option>
                                    <option value="kom-hamada">كوم حمادة</option>
                                    <option value="itay">إيتاي البارود</option>
                                    <option value="delengat">الدلنجات</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button onclick="applyAdvancedSearch()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">تطبيق البحث</button>
                            <button onclick="clearSearchFilters()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors ml-2">مسح الفلاتر</button>
                        </div>
                    </div>
                    
                    <!-- Search Results -->
                    <div id="search-results" class="space-y-6">
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-4">🔍</div>
                            <p>اختر منطقة أو استخدم الفلاتر للبحث عن العقارات</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Properties Tab -->
            <div id="admin-registrations-tab" class="admin-tab active">
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Properties for Sale -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-green-700">🏠 العقارات للبيع</h3>
                            <span id="sellers-count" class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-semibold">0</span>
                        </div>
                        <div id="admin-sellers" class="space-y-4 max-h-96 overflow-y-auto">
                            <!-- Properties for sale will appear here -->
                        </div>
                    </div>

                    <!-- Property Requests -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-blue-700">🔍 طلبات الشراء</h3>
                            <span id="buyers-count" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-semibold">0</span>
                        </div>
                        <div id="admin-buyers" class="space-y-4 max-h-96 overflow-y-auto">
                            <!-- Property purchase requests will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matching System Tab -->
            <div id="admin-matching-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-green-700 mb-6">🤝 نظام التوفيق بين البائعين والمشترين</h3>
                    
                    <!-- Location Matching Buttons -->
                    <div class="grid md:grid-cols-4 gap-4 mb-8">
                        <button onclick="findMatches('damanhour')" class="bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 transition-colors">
                            <div class="text-2xl mb-2">🏙️</div>
                            <div class="font-bold">دمنهور</div>
                            <div class="text-sm mt-1" id="damanhour-matches">0 توافق</div>
                        </button>
                        <button onclick="findMatches('kom-hamada')" class="bg-green-500 text-white p-4 rounded-xl hover:bg-green-600 transition-colors">
                            <div class="text-2xl mb-2">🌿</div>
                            <div class="font-bold">كوم حمادة</div>
                            <div class="text-sm mt-1" id="kom-hamada-matches">0 توافق</div>
                        </button>
                        <button onclick="findMatches('itay')" class="bg-purple-500 text-white p-4 rounded-xl hover:bg-purple-600 transition-colors">
                            <div class="text-2xl mb-2">🏘️</div>
                            <div class="font-bold">إيتاي البارود</div>
                            <div class="text-sm mt-1" id="itay-matches">0 توافق</div>
                        </button>
                        <button onclick="findMatches('delengat')" class="bg-orange-500 text-white p-4 rounded-xl hover:bg-orange-600 transition-colors">
                            <div class="text-2xl mb-2">🌾</div>
                            <div class="font-bold">الدلنجات</div>
                            <div class="text-sm mt-1" id="delengat-matches">0 توافق</div>
                        </button>
                    </div>
                    
                    <!-- Auto Match Button -->
                    <div class="text-center mb-6">
                        <button onclick="autoMatchAll()" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-4 rounded-xl text-lg font-bold hover:from-green-600 hover:to-blue-600 transition-colors">
                            🎯 البحث التلقائي عن جميع التوافقات
                        </button>
                    </div>
                    
                    <!-- Matching Results -->
                    <div id="matching-results" class="space-y-6">
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-4">🤝</div>
                            <p>اختر منطقة للبحث عن التوافقات أو استخدم البحث التلقائي</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Commission Calculator Tab -->
            <div id="admin-commission-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-yellow-700 mb-6">💰 حاسبة العمولة العقارية</h3>
                    
                    <!-- Commission Calculator -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-green-50 p-6 rounded-xl">
                            <h4 class="text-lg font-bold text-green-700 mb-4">💵 حساب عمولة البائع</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">سعر العقار (جنيه)</label>
                                    <input type="number" id="seller-property-price" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="مثال: 2000000">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">نسبة العمولة (%)</label>
                                    <select id="seller-commission-rate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                        <option value="2.5">2.5% (المعدل العالمي)</option>
                                        <option value="2">2% (مخفضة)</option>
                                        <option value="3">3% (مرتفعة)</option>
                                        <option value="1.5">1.5% (خاصة)</option>
                                    </select>
                                </div>
                                <button onclick="calculateSellerCommission()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">احسب عمولة البائع</button>
                                <div id="seller-commission-result" class="bg-white p-4 rounded-lg border-2 border-green-300 hidden">
                                    <!-- Results will appear here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-6 rounded-xl">
                            <h4 class="text-lg font-bold text-blue-700 mb-4">💳 حساب عمولة المشتري</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">سعر العقار (جنيه)</label>
                                    <input type="number" id="buyer-property-price" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="مثال: 2000000">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">نسبة العمولة (%)</label>
                                    <select id="buyer-commission-rate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                        <option value="2.5">2.5% (المعدل العالمي)</option>
                                        <option value="2">2% (مخفضة)</option>
                                        <option value="3">3% (مرتفعة)</option>
                                        <option value="1.5">1.5% (خاصة)</option>
                                    </select>
                                </div>
                                <button onclick="calculateBuyerCommission()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">احسب عمولة المشتري</button>
                                <div id="buyer-commission-result" class="bg-white p-4 rounded-lg border-2 border-blue-300 hidden">
                                    <!-- Results will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Total Commission Summary -->
                    <div class="mt-8 bg-yellow-50 p-6 rounded-xl">
                        <h4 class="text-lg font-bold text-yellow-700 mb-4">📊 ملخص العمولة الإجمالية</h4>
                        <div id="total-commission-summary" class="grid md:grid-cols-3 gap-4">
                            <div class="bg-white p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="total-seller-commission">0</div>
                                <div class="text-sm text-gray-600">عمولة البائع</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="total-buyer-commission">0</div>
                                <div class="text-sm text-gray-600">عمولة المشتري</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-600" id="total-commission">0</div>
                                <div class="text-sm text-gray-600">إجمالي العمولة</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inquiries Management Tab -->
            <div id="admin-inquiries-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-indigo-700 mb-6">📞 إدارة الاستعلامات والمتابعة</h3>
                    
                    <!-- Quick Actions -->
                    <div class="grid md:grid-cols-4 gap-4 mb-8">
                        <button onclick="showInquiryForm()" class="bg-indigo-500 text-white p-4 rounded-xl hover:bg-indigo-600 transition-colors">
                            <div class="text-2xl mb-2">➕</div>
                            <div class="font-bold">إضافة استعلام</div>
                        </button>
                        <button onclick="filterInquiries('pending')" class="bg-yellow-500 text-white p-4 rounded-xl hover:bg-yellow-600 transition-colors">
                            <div class="text-2xl mb-2">⏳</div>
                            <div class="font-bold">قيد المتابعة</div>
                            <div class="text-sm mt-1" id="pending-inquiries">0</div>
                        </button>
                        <button onclick="filterInquiries('contacted')" class="bg-green-500 text-white p-4 rounded-xl hover:bg-green-600 transition-colors">
                            <div class="text-2xl mb-2">✅</div>
                            <div class="font-bold">تم التواصل</div>
                            <div class="text-sm mt-1" id="contacted-inquiries">0</div>
                        </button>
                        <button onclick="filterInquiries('scheduled')" class="bg-blue-500 text-white p-4 rounded-xl hover:bg-blue-600 transition-colors">
                            <div class="text-2xl mb-2">📅</div>
                            <div class="font-bold">مواعيد محددة</div>
                            <div class="text-sm mt-1" id="scheduled-inquiries">0</div>
                        </button>
                    </div>
                    
                    <!-- Inquiries List -->
                    <div id="inquiries-list" class="space-y-4">
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-4">📞</div>
                            <p>لا توجد استعلامات حتى الآن. اضغط "إضافة استعلام" لبدء المتابعة</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Service Requests Tab -->
            <div id="admin-contracting-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-orange-700 mb-6">🏗️ طلبات الخدمات</h3>
                    
                    <!-- Service Requests -->
                    <div class="bg-gray-50 p-6 rounded-xl">
                        <h4 class="text-lg font-bold text-gray-700 mb-4">طلبات الخدمات الواردة</h4>
                        <div id="service-requests" class="space-y-4">
                            <div class="text-center text-gray-500 py-8">
                                <div class="text-4xl mb-4">🏗️</div>
                                <p>لا توجد طلبات خدمات حتى الآن</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contracting Clients Tab -->
            <div id="admin-contracting-clients-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-2xl font-bold text-orange-700">👷 عملاء المقاولات</h3>
                        <div class="flex items-center gap-4">
                            <span id="contracting-clients-count" class="bg-orange-100 text-orange-800 px-4 py-2 rounded-full font-semibold">0 عميل</span>
                            <button onclick="exportContractingClients()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">📊 تصدير البيانات</button>
                        </div>
                    </div>

                    <!-- Search and Filter -->
                    <div class="bg-orange-50 p-4 rounded-lg mb-6">
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">البحث بالاسم أو الرقم</label>
                                <input type="text" id="contracting-search" onkeyup="filterContractingClients()" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" placeholder="ابحث...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">فلترة حسب الخدمة</label>
                                <select id="contracting-service-filter" onchange="filterContractingClients()" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none">
                                    <option value="">جميع الخدمات</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">فلترة حسب الحالة</label>
                                <select id="contracting-status-filter" onchange="filterContractingClients()" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none">
                                    <option value="">جميع الحالات</option>
                                    <option value="pending">قيد المراجعة</option>
                                    <option value="contacted">تم التواصل</option>
                                    <option value="in-progress">قيد التنفيذ</option>
                                    <option value="completed">مكتمل</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Contracting Clients List -->
                    <div id="contracting-clients-list" class="space-y-4">
                        <div class="text-center text-gray-500 py-8">
                            <div class="text-4xl mb-4">👷</div>
                            <p>لا توجد عملاء مقاولات حتى الآن</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Management Tab -->
            <div id="admin-services-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-2xl font-bold text-orange-700">⚙️ إدارة الخدمات</h3>
                        <button onclick="showAddServiceForm()" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors">➕ إضافة خدمة جديدة</button>
                    </div>

                    <!-- Add Service Form -->
                    <div id="add-service-form" class="bg-orange-50 rounded-lg p-6 mb-8 hidden">
                        <h4 class="text-lg font-bold text-orange-700 mb-4">إضافة خدمة جديدة</h4>
                        <form onsubmit="addNewService(event)">
                            <div class="grid md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">عنوان الخدمة</label>
                                    <input type="text" id="new-service-title" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">الفئة</label>
                                    <select id="new-service-category" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                        <option value="">اختر الفئة</option>
                                        <option value="تصميم">تصميم</option>
                                        <option value="مقاولات">مقاولات</option>
                                        <option value="تشطيبات">تشطيبات</option>
                                        <option value="صيانة">صيانة</option>
                                        <option value="استشارات">استشارات</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">الأيقونة</label>
                                    <select id="new-service-icon" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                        <option value="">اختر الأيقونة</option>
                                        <option value="🏠">🏠 شقة</option>
                                        <option value="🏪">🏪 محل</option>
                                        <option value="🏢">🏢 مكتب</option>
                                        <option value="🏗️">🏗️ بناء</option>
                                        <option value="🔑">🔑 مفتاح</option>
                                        <option value="🎨">🎨 تصميم</option>
                                        <option value="🔧">🔧 صيانة</option>
                                        <option value="📐">📐 هندسة</option>
                                        <option value="💡">💡 إضاءة</option>
                                        <option value="🪟">🪟 نوافذ</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">السعر</label>
                                    <input type="text" id="new-service-price" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" placeholder="مثال: يبدأ من 15,000 جنيه" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">وصف الخدمة</label>
                                <textarea id="new-service-description" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-24" placeholder="اكتب وصف مفصل للخدمة..." required></textarea>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المميزات (كل ميزة في سطر منفصل)</label>
                                <textarea id="new-service-features" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-24" placeholder="تصميم ثلاثي الأبعاد&#10;اختيار الألوان والمواد&#10;تخطيط المساحات" required></textarea>
                            </div>
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="new-service-active" class="mr-2 w-5 h-5" checked>
                                    <span class="font-semibold text-gray-700">خدمة نشطة (ستظهر في الصفحة الرئيسية)</span>
                                </label>
                            </div>
                            <div class="flex gap-4">
                                <button type="submit" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors">إضافة الخدمة</button>
                                <button type="button" onclick="hideAddServiceForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            </div>
                        </form>
                    </div>

                    <!-- Services List -->
                    <div id="services-list" class="space-y-4">
                        <!-- Services will appear here -->
                    </div>
                </div>
            </div>

            <!-- Admins Management Tab -->
            <div id="admin-admins-tab" class="admin-tab">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="text-2xl font-bold text-purple-700">إدارة المديرين</h3>
                        <button onclick="showAddAdminForm()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors">➕ إضافة مدير جديد</button>
                    </div>

                    <!-- Add Admin Form -->
                    <div id="add-admin-form" class="bg-purple-50 rounded-lg p-6 mb-8 hidden">
                        <h4 class="text-lg font-bold text-purple-700 mb-4">إضافة مدير جديد</h4>
                        <form onsubmit="addNewAdmin(event)">
                            <div class="grid md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">اسم المستخدم</label>
                                    <input type="text" id="new-admin-username" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">كلمة المرور</label>
                                    <input type="password" id="new-admin-password" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الاسم الكامل</label>
                                <input type="text" id="new-admin-fullname" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                            </div>
                            <div class="flex gap-4">
                                <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">إضافة المدير</button>
                                <button type="button" onclick="hideAddAdminForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            </div>
                        </form>
                    </div>

                    <!-- Admins List -->
                    <div id="admins-list" class="space-y-4">
                        <!-- Admins will appear here -->
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="admin-statistics-tab" class="admin-tab">
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                        <div class="text-4xl mb-2">🏠</div>
                        <h3 class="text-2xl font-bold text-green-600" id="total-properties">0</h3>
                        <p class="text-gray-600">إجمالي العقارات</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                        <div class="text-4xl mb-2">🔍</div>
                        <h3 class="text-2xl font-bold text-blue-600" id="total-requests">0</h3>
                        <p class="text-gray-600">طلبات الشراء</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-xl p-6 text-center">
                        <div class="text-4xl mb-2">👥</div>
                        <h3 class="text-2xl font-bold text-purple-600" id="total-admins">1</h3>
                        <p class="text-gray-600">عدد المديرين</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">إحصائيات مفصلة</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-bold text-gray-700 mb-4">العقارات حسب النوع</h4>
                            <div id="property-types-stats" class="space-y-2">
                                <!-- Property type statistics will appear here -->
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-700 mb-4">العقارات حسب المنطقة</h4>
                            <div id="location-stats" class="space-y-2">
                                <!-- Location statistics will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPropertyType = '';
        let currentBuyerPropertyType = '';
        let sellerRegistrations = [];
        let buyerRegistrations = [];
        let currentAdmin = null;
        let adminClickCounter = 0;
        let inquiries = [];
        let notifications = [];
        let serviceRequests = [];
        let contractingClients = [];
        let contractingServices = [
            {
                id: 1,
                title: 'تصميم الشقق السكنية',
                description: 'خدمات تصميم داخلي وخارجي للشقق السكنية بأحدث الطرق والتقنيات',
                features: ['تصميم ثلاثي الأبعاد', 'اختيار الألوان والمواد', 'تخطيط المساحات', 'إشراف على التنفيذ'],
                price: 'للاستعلام عن الأسعار تواصل معنا',
                category: 'تصميم',
                icon: '🏠',
                active: true,
                createdAt: new Date().toLocaleString('ar-EG')
            },
            {
                id: 2,
                title: 'تصميم المحلات التجارية',
                description: 'تصميم وتجهيز المحلات التجارية لجذب العملاء وزيادة المبيعات',
                features: ['تصميم الواجهة', 'تخطيط المساحة الداخلية', 'الإضاءة والديكور', 'أنظمة العرض'],
                price: 'للاستعلام عن الأسعار تواصل معنا',
                category: 'تصميم',
                icon: '🏪',
                active: true,
                createdAt: new Date().toLocaleString('ar-EG')
            },
            {
                id: 3,
                title: 'مقاولات استلام على المفتاح',
                description: 'مقاولات كاملة من البداية حتى الاستلام النهائي جاهز للسكن',
                features: ['أعمال البناء الكاملة', 'التشطيبات الداخلية', 'السباكة والكهرباء', 'الدهانات والأرضيات'],
                price: 'للاستعلام عن الأسعار تواصل معنا',
                category: 'مقاولات',
                icon: '🔑',
                active: true,
                createdAt: new Date().toLocaleString('ar-EG')
            }
        ];
        let adminUsers = [
            {
                id: 1,
                username: 'admintito',
                password: '0453328124',
                fullName: 'المدير الرئيسي',
                isMainAdmin: true,
                createdAt: new Date().toLocaleString('ar-EG')
            }
        ];

        // Notification system
        function addNotification(title, message, type = 'info') {
            const notification = {
                id: Date.now(),
                title: title,
                message: message,
                type: type,
                timestamp: new Date().toLocaleString('ar-EG'),
                read: false
            };
            
            notifications.unshift(notification);
            updateNotificationBell();
            playNotificationSound();
        }

        function updateNotificationBell() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const countElement = document.getElementById('notification-count');
            
            if (unreadCount > 0) {
                countElement.textContent = unreadCount;
                countElement.classList.remove('hidden');
            } else {
                countElement.classList.add('hidden');
            }
        }

        function playNotificationSound() {
            // Create audio context for notification sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.log('Audio notification not supported');
            }
        }

        function showNotifications() {
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">🔔 الإشعارات</h3>
                        <div class="flex gap-2">
                            <button onclick="markAllAsRead()" class="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">تحديد الكل كمقروء</button>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        ${notifications.length > 0 ? notifications.map(notification => `
                            <div class="p-4 rounded-lg border ${notification.read ? 'bg-gray-50 border-gray-200' : 'bg-blue-50 border-blue-300'} ${!notification.read ? 'font-semibold' : ''}">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-sm font-bold text-gray-800">${notification.title}</h4>
                                    <span class="text-xs text-gray-500">${notification.timestamp}</span>
                                </div>
                                <p class="text-sm text-gray-600">${notification.message}</p>
                                ${!notification.read ? `<button onclick="markAsRead(${notification.id})" class="text-xs text-blue-600 hover:text-blue-800 mt-2">تحديد كمقروء</button>` : ''}
                            </div>
                        `).join('') : '<p class="text-center text-gray-500 py-8">لا توجد إشعارات</p>'}
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function markAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotificationBell();
                showNotifications();
                document.querySelector('.fixed').remove();
                showNotifications();
            }
        }

        function markAllAsRead() {
            notifications.forEach(n => n.read = true);
            updateNotificationBell();
            showNotifications();
            document.querySelector('.fixed').remove();
            showNotifications();
        }

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            document.getElementById('home-section').style.display = 'none';
            
            // Show selected section
            if (section === 'home') {
                document.getElementById('home-section').style.display = 'block';
            } else {
                document.getElementById(section + '-section').classList.add('active');
            }
        }

        function adminClickCount() {
            adminClickCounter++;
            if (adminClickCounter >= 11) {
                adminClickCounter = 0;
                showSection('admin-login');
            }
        }

        function showAdminLogin() {
            showSection('admin-login');
        }

        function adminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            const admin = adminUsers.find(a => a.username === username && a.password === password);
            
            if (admin) {
                currentAdmin = admin;
                document.getElementById('admin-welcome').textContent = `مرحباً، ${admin.fullName}`;
                showSection('admin-dashboard');
                showAdminTab('registrations');
                updateAdminPanel();
                updateAdminsList();
                updateStatistics();
                
                // Clear login form
                document.getElementById('admin-login-form').reset();
            } else {
                showCustomAlert('خطأ في تسجيل الدخول', 'اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        }

        function adminLogout() {
            currentAdmin = null;
            showSection('home');
            showCustomAlert('تم تسجيل الخروج', 'تم تسجيل الخروج بنجاح');
        }

        function showAdminTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-purple-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            // Show selected tab
            document.getElementById(`admin-${tabName}-tab`).classList.add('active');
            event.target.classList.add('active', 'bg-purple-600', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
        }

        function showAddAdminForm() {
            document.getElementById('add-admin-form').classList.remove('hidden');
        }

        function hideAddAdminForm() {
            document.getElementById('add-admin-form').classList.add('hidden');
            document.querySelector('#add-admin-form form').reset();
        }

        function addNewAdmin(event) {
            event.preventDefault();
            
            const username = document.getElementById('new-admin-username').value;
            const password = document.getElementById('new-admin-password').value;
            const fullName = document.getElementById('new-admin-fullname').value;
            
            // Check if username already exists
            if (adminUsers.find(a => a.username === username)) {
                showCustomAlert('خطأ', 'اسم المستخدم موجود بالفعل');
                return;
            }
            
            const newAdmin = {
                id: Date.now(),
                username: username,
                password: password,
                fullName: fullName,
                isMainAdmin: false,
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName
            };
            
            adminUsers.push(newAdmin);
            updateAdminsList();
            updateStatistics();
            hideAddAdminForm();
            
            showCustomAlert('تم بنجاح', `تم إضافة المدير "${fullName}" بنجاح`);
        }

        function updateAdminsList() {
            const adminsList = document.getElementById('admins-list');
            
            adminsList.innerHTML = adminUsers.map(admin => `
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-purple-700">${admin.fullName}</h4>
                            <p class="text-sm text-gray-600">اسم المستخدم: ${admin.username}</p>
                            <p class="text-sm text-gray-600">تاريخ الإنشاء: ${admin.createdAt}</p>
                            ${admin.createdBy ? `<p class="text-sm text-gray-600">أنشئ بواسطة: ${admin.createdBy}</p>` : ''}
                            ${admin.isMainAdmin ? '<span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold mt-2">المدير الرئيسي</span>' : ''}
                        </div>
                        <div class="flex gap-2">
                            ${!admin.isMainAdmin ? `
                                <button onclick="editAdmin(${admin.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">تعديل</button>
                                <button onclick="deleteAdmin(${admin.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">حذف</button>
                            ` : '<span class="text-xs text-gray-500">لا يمكن حذفه</span>'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function editAdmin(adminId) {
            showCustomAlert('تعديل المدير', 'ميزة تعديل بيانات المدير ستكون متاحة قريباً');
        }

        function deleteAdmin(adminId) {
            const admin = adminUsers.find(a => a.id === adminId);
            if (!admin) return;
            
            showCustomConfirm('حذف المدير', `هل أنت متأكد من حذف المدير "${admin.fullName}"؟`, () => {
                adminUsers = adminUsers.filter(a => a.id !== adminId);
                updateAdminsList();
                updateStatistics();
                showCustomAlert('تم الحذف', 'تم حذف المدير بنجاح');
            });
        }

        function updateStatistics() {
            // Update counts
            document.getElementById('sellers-count').textContent = sellerRegistrations.length;
            document.getElementById('buyers-count').textContent = buyerRegistrations.length;
            document.getElementById('total-properties').textContent = sellerRegistrations.length;
            document.getElementById('total-requests').textContent = buyerRegistrations.length;
            document.getElementById('total-admins').textContent = adminUsers.length;
            
            // Update property types statistics
            const propertyTypesStats = {};
            sellerRegistrations.forEach(seller => {
                const type = getPropertyTypeArabic(seller.propertyType);
                propertyTypesStats[type] = (propertyTypesStats[type] || 0) + 1;
            });
            
            const propertyTypesContainer = document.getElementById('property-types-stats');
            propertyTypesContainer.innerHTML = Object.entries(propertyTypesStats).map(([type, count]) => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span>${type}</span>
                    <span class="font-semibold text-green-600">${count}</span>
                </div>
            `).join('') || '<p class="text-gray-500">لا توجد بيانات</p>';
            
            // Update location statistics
            const locationStats = {};
            sellerRegistrations.forEach(seller => {
                const location = getLocationArabic(seller.location);
                locationStats[location] = (locationStats[location] || 0) + 1;
            });
            
            const locationContainer = document.getElementById('location-stats');
            locationContainer.innerHTML = Object.entries(locationStats).map(([location, count]) => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                    <span>${location}</span>
                    <span class="font-semibold text-blue-600">${count}</span>
                </div>
            `).join('') || '<p class="text-gray-500">لا توجد بيانات</p>';
        }

        function showSellerForm() {
            showSection('seller');
        }

        function showBuyerForm() {
            showSection('buyer');
        }

        function selectPropertyType(type) {
            currentPropertyType = type;
            
            // Update button styles
            document.querySelectorAll('.property-type-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-100');
                btn.classList.add('border-gray-300');
            });
            event.target.closest('.property-type-btn').classList.add('border-green-500', 'bg-green-100');
            
            // Generate appropriate form
            generatePropertyForm(type);
        }

        function selectBuyerPropertyType(type) {
            currentBuyerPropertyType = type;
            
            // Update button styles
            document.querySelectorAll('.buyer-property-type-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-100');
                btn.classList.add('border-gray-300');
            });
            event.target.closest('.buyer-property-type-btn').classList.add('border-blue-500', 'bg-blue-100');
        }

        function generatePropertyForm(type) {
            const container = document.getElementById('property-details');
            let formHTML = '';

            switch(type) {
                case 'apartment':
                    formHTML = generateApartmentForm();
                    break;
                case 'house':
                    formHTML = generateHouseForm();
                    break;
                case 'land':
                    formHTML = generateLandForm();
                    break;
                case 'shop':
                    formHTML = generateShopForm();
                    break;
                case 'office':
                    formHTML = generateOfficeForm();
                    break;
                case 'villa':
                    formHTML = generateVillaForm();
                    break;
                case 'building-land':
                    formHTML = generateBuildingLandForm();
                    break;
            }

            container.innerHTML = formHTML;
        }

        function generateApartmentForm() {
            return `
                <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل الشقة</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مساحة الشقة (متر مربع)</label>
                            <input type="number" id="apartment-area" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الغرف</label>
                            <select id="apartment-rooms" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر عدد الغرف</option>
                                <option value="1">غرفة واحدة</option>
                                <option value="2">غرفتان</option>
                                <option value="3">3 غرف</option>
                                <option value="4">4 غرف</option>
                                <option value="5+">5 غرف أو أكثر</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الحمامات</label>
                            <select id="apartment-bathrooms" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر عدد الحمامات</option>
                                <option value="1">حمام واحد</option>
                                <option value="2">حمامان</option>
                                <option value="3">3 حمامات</option>
                                <option value="4+">4 حمامات أو أكثر</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الدور</label>
                            <select id="apartment-floor" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر الدور</option>
                                <option value="ground">الأرضي</option>
                                <option value="1">الأول</option>
                                <option value="2">الثاني</option>
                                <option value="3">الثالث</option>
                                <option value="4">الرابع</option>
                                <option value="5+">الخامس أو أعلى</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">حصة الشقة في الأرض</label>
                            <input type="text" id="apartment-share" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="مثال: 1/8" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة المباني</label>
                            <input type="number" id="apartment-year" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">مستوى التشطيب</label>
                        <select id="apartment-finishing" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                            <option value="">اختر مستوى التشطيب</option>
                            <option value="finished">متشطبة كاملة</option>
                            <option value="semi-finished">نصف تشطيب</option>
                            <option value="unfinished">على الطوبة</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">العدادات المتاحة</label>
                        <div class="flex gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-electricity" class="mr-2">
                                <span>كهرباء</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-gas" class="mr-2">
                                <span>غاز</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-water" class="mr-2">
                                <span>مياه</span>
                            </label>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">الامتيازات</label>
                        <div class="grid md:grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-elevator" class="mr-2">
                                <span>أسانسير</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-hotel-entrance" class="mr-2">
                                <span>مدخل فندقي</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-security" class="mr-2">
                                <span>أمن وحراسة</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="apartment-garden" class="mr-2">
                                <span>حديقة</span>
                            </label>
                        </div>
                    </div>

                    ${generatePricingSection('apartment')}
                    ${generateImageUploadSection()}
                    ${generateNotesSection()}
                </div>
            `;
        }

        function generateHouseForm() {
            return `
                <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل البيت</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مساحة العقار (متر مربع)</label>
                            <input type="number" id="house-area" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الأدوار</label>
                            <select id="house-floors" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر عدد الأدوار</option>
                                <option value="1">دور واحد</option>
                                <option value="2">دورين</option>
                                <option value="3">ثلاثة أدوار</option>
                                <option value="4+">أربعة أدوار أو أكثر</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الشقق في الدور</label>
                            <select id="house-apartments-per-floor" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر عدد الشقق</option>
                                <option value="1">شقة واحدة</option>
                                <option value="2">شقتان</option>
                                <option value="3">ثلاث شقق</option>
                                <option value="4+">أربع شقق أو أكثر</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مساحة الشقة (متر مربع)</label>
                            <input type="number" id="house-apartment-area" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة المباني</label>
                            <input type="number" id="house-year" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مستوى التشطيب</label>
                            <select id="house-finishing" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر مستوى التشطيب</option>
                                <option value="finished">متشطب كامل</option>
                                <option value="semi-finished">نصف تشطيب</option>
                                <option value="unfinished">على الطوبة</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">العدادات المتاحة</label>
                        <div class="flex gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="house-electricity" class="mr-2">
                                <span>كهرباء</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="house-gas" class="mr-2">
                                <span>غاز</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="house-water" class="mr-2">
                                <span>مياه</span>
                            </label>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">الامتيازات</label>
                        <div class="grid md:grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="house-security" class="mr-2">
                                <span>أمن وحراسة</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="house-elevator" class="mr-2">
                                <span>أسانسير</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="house-garden" class="mr-2">
                                <span>حديقة</span>
                            </label>
                        </div>
                    </div>

                    ${generatePricingSection('house')}
                    ${generateImageUploadSection()}
                    ${generateNotesSection()}
                </div>
            `;
        }

        function generateShopForm() {
            return `
                <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل المحل</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مساحة المحل (متر مربع)</label>
                            <input type="number" id="shop-area" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">حصة المحل في الأرض</label>
                            <input type="text" id="shop-share" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="مثال: 1/10">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة المباني</label>
                            <input type="number" id="shop-year" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مستوى التشطيب</label>
                            <select id="shop-finishing" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر مستوى التشطيب</option>
                                <option value="finished">محل مجهز</option>
                                <option value="semi-finished">نصف تشطيب</option>
                                <option value="unfinished">على الطوبة</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">الامتيازات</label>
                        <div class="grid md:grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="shop-street-front" class="mr-2">
                                <span>واجهة شارع عمومي</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shop-busy-street" class="mr-2">
                                <span>شارع حيوي</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shop-commercial-area" class="mr-2">
                                <span>منطقة تجارية</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shop-public-location" class="mr-2">
                                <span>مكان عمومي</span>
                            </label>
                        </div>
                    </div>

                    ${generatePricingSection('shop', 17, 19)}
                    ${generateImageUploadSection()}
                    ${generateNotesSection()}
                </div>
            `;
        }

        function generateLandForm() {
            return `
                <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل الأرض</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">نوع الأرض</label>
                            <select id="land-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر نوع الأرض</option>
                                <option value="building">أرض مباني</option>
                                <option value="agricultural">أرض زراعية</option>
                                <option value="mixed">متخللات</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة (متر مربع)</label>
                            <input type="number" id="land-area-meters" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة (قيراط)</label>
                            <input type="number" step="0.01" id="land-area-qirat" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الأرض مرخصة؟</label>
                            <select id="land-licensed" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر</option>
                                <option value="yes">نعم، مرخصة</option>
                                <option value="no">لا، غير مرخصة</option>
                            </select>
                        </div>
                    </div>

                    <div id="building-license-year" class="mb-4" style="display: none;">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">كردون المباني من سنة</label>
                        <input type="number" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                    </div>

                    ${generatePricingSection('land', 14, 17)}
                    ${generateImageUploadSection()}
                    ${generateNotesSection()}
                </div>
            `;
        }

        function generateVillaForm() {
            return `
                <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل الفيلا</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة (متر مربع)</label>
                            <input type="number" id="villa-area-meters" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة (قيراط)</label>
                            <input type="number" step="0.01" id="villa-area-qirat" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد الأدوار</label>
                            <select id="villa-floors" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                <option value="">اختر عدد الأدوار</option>
                                <option value="1">دور واحد</option>
                                <option value="2">دورين</option>
                                <option value="3">ثلاثة أدوار</option>
                                <option value="4+">أربعة أدوار أو أكثر</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">عدد المرافق</label>
                            <input type="number" id="villa-facilities" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="مثال: 8">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة المباني</label>
                            <input type="number" id="villa-year" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سنة الرخصة</label>
                            <input type="number" id="villa-license-year" min="1980" max="2024" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">التجهيزات</label>
                        <select id="villa-furnished" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                            <option value="">اختر مستوى التجهيز</option>
                            <option value="furnished">مجهزة بالكامل</option>
                            <option value="unfurnished">بدون تجهيزات</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">العدادات المتاحة</label>
                        <div class="flex gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="villa-electricity" class="mr-2">
                                <span>كهرباء</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="villa-gas" class="mr-2">
                                <span>غاز</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="villa-water" class="mr-2">
                                <span>مياه</span>
                            </label>
                        </div>
                    </div>

                    ${generatePricingSection('villa', 20, 21)}
                    ${generateImageUploadSection()}
                    ${generateNotesSection()}
                </div>
            `;
        }

        function generateOfficeForm() {
            return generateApartmentForm().replace(/apartment/g, 'office').replace('تفاصيل الشقة', 'تفاصيل المكتب');
        }

        function generateBuildingLandForm() {
            return generateLandForm().replace('تفاصيل الأرض', 'تفاصيل أرض المباني');
        }

        function generatePricingSection(type, minPrice = 14, maxPrice = 16) {
            return `
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">سعر المتر (جنيه)</label>
                    <input type="number" id="${type}-price-per-meter" onchange="checkPricing('${type}', ${minPrice}, ${maxPrice})" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                    <div id="${type}-price-warning" class="price-warning mt-2 p-3 rounded-lg hidden">
                        <p class="text-amber-800 font-semibold">⚠️ سعر المتر المحدد للمنطقة هو ${minPrice} - ${maxPrice} جنيه للمتر. إذا كان السعر أعلى، سيتم وضع العقار كـ "قابل للتفاوض"</p>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">السعر الكلي (جنيه)</label>
                        <input type="number" id="${type}-total-price" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                    </div>
                    <div id="${type}-negotiable-container" class="hidden">
                        <label class="flex items-center mt-8">
                            <input type="checkbox" id="${type}-negotiable" class="mr-2 w-5 h-5">
                            <span class="font-semibold text-amber-700">قابل للتفاوض</span>
                        </label>
                    </div>
                </div>
            `;
        }

        function generateImageUploadSection() {
            return `
                <div class="mb-6">
                    <label class="block text-lg font-semibold text-gray-700 mb-4">صور العقار (مطلوب 4 صور على الأقل)</label>
                    <div class="bg-blue-50 border-2 border-dashed border-blue-300 rounded-lg p-6">
                        <div class="text-center mb-4">
                            <div class="text-4xl mb-2">📷</div>
                            <p class="text-blue-700 font-semibold mb-2">اختر صور العقار</p>
                            <p class="text-sm text-blue-600">يمكنك اختيار عدة صور في نفس الوقت (الحد الأدنى 4 صور)</p>
                        </div>
                        <input type="file" id="property-images" accept="image/*" multiple required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                        <div id="image-preview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                            <!-- Image previews will appear here -->
                        </div>
                        <div id="image-count" class="mt-2 text-sm text-gray-600 hidden">
                            <!-- Image count will appear here -->
                        </div>
                    </div>
                </div>
            `;
        }

        function generateNotesSection() {
            return `
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ملاحظات إضافية</label>
                    <textarea class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none h-32" placeholder="اكتب أي ملاحظات أو امتيازات إضافية..."></textarea>
                </div>
            `;
        }

        function checkPricing(type, minPrice, maxPrice) {
            const priceInput = document.getElementById(`${type}-price-per-meter`);
            const warningDiv = document.getElementById(`${type}-price-warning`);
            const negotiableContainer = document.getElementById(`${type}-negotiable-container`);
            const negotiableCheckbox = document.getElementById(`${type}-negotiable`);
            
            const price = parseFloat(priceInput.value);
            
            if (price > maxPrice) {
                warningDiv.classList.remove('hidden');
                negotiableContainer.classList.remove('hidden');
                negotiableCheckbox.required = true;
                negotiableCheckbox.checked = true;
            } else {
                warningDiv.classList.add('hidden');
                negotiableContainer.classList.add('hidden');
                negotiableCheckbox.required = false;
                negotiableCheckbox.checked = false;
            }
        }

        function updatePriceRange() {
            const location = document.getElementById('buyer-location').value;
            const infoDiv = document.getElementById('price-range-info');
            
            if (location) {
                infoDiv.classList.remove('hidden');
                let priceRange = '';
                
                switch(location) {
                    case 'damanhour':
                        priceRange = 'دمنهور: الأسعار تبدأ من 16,000 إلى 22,000 جنيه للمتر حسب الموقع';
                        break;
                    case 'kom-hamada':
                        priceRange = 'كوم حمادة: الأسعار تتراوح من 16,000 إلى 24,000 جنيه للمتر حسب حيوية المنطقة';
                        break;
                    case 'itay':
                        priceRange = 'إيتاي البارود: الأسعار تتراوح من 14,000 إلى 20,000 جنيه للمتر';
                        break;
                    case 'delengat':
                        priceRange = 'الدلنجات: الأسعار تتراوح من 12,000 إلى 18,000 جنيه للمتر';
                        break;
                }
                
                infoDiv.innerHTML = `<p class="text-sm text-blue-800 font-semibold">💡 ${priceRange}</p>
                                   <p class="text-sm text-blue-600 mt-1">الأسعار تتحدد حسب المساحة والموقع والمباني (حديثة أم قديمة) ومستوى التشطيب</p>`;
            } else {
                infoDiv.classList.add('hidden');
            }
        }

        function validateWhatsApp(phoneNumber) {
            // Egyptian phone number validation
            const egyptianPhoneRegex = /^(010|011|012|015)\d{8}$/;
            return egyptianPhoneRegex.test(phoneNumber.replace(/\s+/g, ''));
        }

        function submitSellerForm(event) {
            event.preventDefault();
            
            const whatsappNumber = document.getElementById('seller-whatsapp').value;
            if (!validateWhatsApp(whatsappNumber)) {
                showCustomAlert('خطأ', 'رقم الواتساب غير صحيح. يجب أن يبدأ بـ 010, 011, 012, أو 015 ويتكون من 11 رقم');
                return;
            }
            
            if (!currentPropertyType) {
                showCustomAlert('خطأ', 'يرجى اختيار نوع العقار');
                return;
            }
            
            // Collect form data
            const formData = {
                id: Date.now(),
                type: 'seller',
                propertyType: currentPropertyType,
                location: document.getElementById('seller-location').value,
                mapLocation: document.getElementById('map-location').value,
                name: document.getElementById('seller-name').value,
                whatsapp: whatsappNumber,
                timestamp: new Date().toLocaleString('ar-EG')
            };
            
            // Add property-specific data
            const propertyData = collectPropertyData(currentPropertyType);
            Object.assign(formData, propertyData);
            
            // Add images data
            const imageInput = document.getElementById('property-images');
            if (imageInput && imageInput.files.length > 0) {
                formData.images = [];
                Array.from(imageInput.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        formData.images.push({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: e.target.result
                        });
                        
                        // Save when all images are processed
                        if (formData.images.length === imageInput.files.length) {
                            saveSellerRegistration(formData);
                        }
                    };
                    reader.readAsDataURL(file);
                });
                return; // Exit here, saveSellerRegistration will be called after images are processed
            } else {
                saveSellerRegistration(formData);
            }
        }

        function saveSellerRegistration(formData) {
            // Save to registrations
            sellerRegistrations.push(formData);
            
            // Add notification for new property
            addNotification('عقار جديد مسجل', `تم تسجيل ${getPropertyTypeArabic(formData.propertyType)} جديد في ${getLocationArabic(formData.location)} بواسطة ${formData.name}`, 'success');
            
            // Update admin panel
            updateAdminPanel();
            
            // Update listings
            updateListings();
            
            // Update search counts
            updateLocationCounts();
            
            showCustomAlert('تم بنجاح', 'تم تسجيل العقار بنجاح! سيتم التواصل معك قريباً.');
            
            // Reset form
            document.getElementById('seller-form').reset();
            currentPropertyType = '';
            document.getElementById('property-details').innerHTML = '';
            document.querySelectorAll('.property-type-btn').forEach(btn => {
                btn.classList.remove('border-green-500', 'bg-green-100');
                btn.classList.add('border-gray-300');
            });
            
            // Reset image preview
            const previewContainer = document.getElementById('image-preview');
            const countContainer = document.getElementById('image-count');
            if (previewContainer) previewContainer.classList.add('hidden');
            if (countContainer) countContainer.classList.add('hidden');
        }

        // Advanced Search Functions
        function searchByLocation(location) {
            const sellers = sellerRegistrations.filter(s => s.location === location);
            const buyers = buyerRegistrations.filter(b => b.location === location);
            
            displaySearchResults(sellers, buyers, location);
        }

        function applyAdvancedSearch() {
            const propertyType = document.getElementById('search-property-type').value;
            const clientType = document.getElementById('search-client-type').value;
            const location = document.getElementById('search-location-filter').value;
            
            let sellers = sellerRegistrations;
            let buyers = buyerRegistrations;
            
            // Apply filters
            if (propertyType) {
                sellers = sellers.filter(s => s.propertyType === propertyType);
                buyers = buyers.filter(b => b.propertyType === propertyType);
            }
            
            if (location) {
                sellers = sellers.filter(s => s.location === location);
                buyers = buyers.filter(b => b.location === location);
            }
            
            // Apply client type filter
            if (clientType === 'seller') {
                buyers = [];
            } else if (clientType === 'buyer') {
                sellers = [];
            }
            
            displaySearchResults(sellers, buyers, location || 'جميع المناطق');
        }

        function clearSearchFilters() {
            document.getElementById('search-property-type').value = '';
            document.getElementById('search-client-type').value = '';
            document.getElementById('search-location-filter').value = '';
            
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <div class="text-4xl mb-4">🔍</div>
                    <p>اختر منطقة أو استخدم الفلاتر للبحث عن العقارات</p>
                </div>
            `;
        }

        function displaySearchResults(sellers, buyers, locationName) {
            const resultsContainer = document.getElementById('search-results');
            
            resultsContainer.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">نتائج البحث - ${locationName}</h4>
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600">${sellers.length}</div>
                            <div class="text-sm text-gray-600">عقار للبيع</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600">${buyers.length}</div>
                            <div class="text-sm text-gray-600">طلب شراء</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-600">${sellers.length + buyers.length}</div>
                            <div class="text-sm text-gray-600">إجمالي العملاء</div>
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Sellers -->
                    <div class="bg-green-50 p-6 rounded-xl">
                        <h5 class="text-lg font-bold text-green-700 mb-4">🏠 العقارات للبيع (${sellers.length})</h5>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${sellers.length > 0 ? sellers.map(seller => `
                                <div class="bg-white p-3 rounded-lg border border-green-200">
                                    <div class="flex justify-between items-start mb-2">
                                        <h6 class="font-bold text-green-700">${getPropertyTypeArabic(seller.propertyType)}</h6>
                                        <span class="text-xs text-gray-500">${seller.timestamp}</span>
                                    </div>
                                    <p class="text-sm text-gray-600">👤 ${seller.name}</p>
                                    <p class="text-sm text-gray-600">📱 ${seller.whatsapp}</p>
                                    ${seller.area ? `<p class="text-sm text-gray-600">📐 ${seller.area} م²</p>` : ''}
                                    ${seller.totalPrice ? `<p class="text-sm font-bold text-green-600">💰 ${Number(seller.totalPrice).toLocaleString()} جنيه</p>` : ''}
                                    <div class="mt-2 flex gap-2">
                                        <button onclick="copyWhatsAppLink('${seller.whatsapp}', 'seller')" class="text-xs bg-green-500 text-white px-2 py-1 rounded">واتساب</button>
                                        <button onclick="viewFullDetails(${seller.id}, 'seller')" class="text-xs bg-blue-500 text-white px-2 py-1 rounded">التفاصيل</button>
                                    </div>
                                </div>
                            `).join('') : '<p class="text-center text-gray-500 py-4">لا توجد عقارات للبيع</p>'}
                        </div>
                    </div>
                    
                    <!-- Buyers -->
                    <div class="bg-blue-50 p-6 rounded-xl">
                        <h5 class="text-lg font-bold text-blue-700 mb-4">🔍 طلبات الشراء (${buyers.length})</h5>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${buyers.length > 0 ? buyers.map(buyer => `
                                <div class="bg-white p-3 rounded-lg border border-blue-200">
                                    <div class="flex justify-between items-start mb-2">
                                        <h6 class="font-bold text-blue-700">مطلوب ${getPropertyTypeArabic(buyer.propertyType)}</h6>
                                        <span class="text-xs text-gray-500">${buyer.timestamp}</span>
                                    </div>
                                    <p class="text-sm text-gray-600">👤 ${buyer.name}</p>
                                    <p class="text-sm text-gray-600">📱 ${buyer.whatsapp}</p>
                                    <div class="mt-2 flex gap-2">
                                        <button onclick="copyWhatsAppLink('${buyer.whatsapp}', 'buyer')" class="text-xs bg-blue-500 text-white px-2 py-1 rounded">واتساب</button>
                                        <button onclick="editBuyerData(${buyer.id})" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">تعديل</button>
                                    </div>
                                </div>
                            `).join('') : '<p class="text-center text-gray-500 py-4">لا توجد طلبات شراء</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function updateLocationCounts() {
            const locations = ['damanhour', 'kom-hamada', 'itay', 'delengat'];
            
            locations.forEach(location => {
                const sellersCount = sellerRegistrations.filter(s => s.location === location).length;
                const buyersCount = buyerRegistrations.filter(b => b.location === location).length;
                const totalCount = sellersCount + buyersCount;
                
                const countElement = document.getElementById(`${location}-count`);
                if (countElement) {
                    countElement.textContent = `${totalCount} عقار`;
                }
            });
        }

        // Matching System Functions
        function findMatches(location) {
            const sellers = sellerRegistrations.filter(s => s.location === location);
            const buyers = buyerRegistrations.filter(b => b.location === location);
            
            const matches = [];
            
            sellers.forEach(seller => {
                buyers.forEach(buyer => {
                    if (seller.propertyType === buyer.propertyType) {
                        const matchScore = calculateMatchScore(seller, buyer);
                        if (matchScore > 0) {
                            matches.push({
                                seller: seller,
                                buyer: buyer,
                                score: matchScore,
                                location: location
                            });
                        }
                    }
                });
            });
            
            displayMatchingResults(matches, location);
        }

        function autoMatchAll() {
            const allMatches = [];
            const locations = ['damanhour', 'kom-hamada', 'itay', 'delengat'];
            
            locations.forEach(location => {
                const sellers = sellerRegistrations.filter(s => s.location === location);
                const buyers = buyerRegistrations.filter(b => b.location === location);
                
                sellers.forEach(seller => {
                    buyers.forEach(buyer => {
                        if (seller.propertyType === buyer.propertyType) {
                            const matchScore = calculateMatchScore(seller, buyer);
                            if (matchScore > 0) {
                                allMatches.push({
                                    seller: seller,
                                    buyer: buyer,
                                    score: matchScore,
                                    location: location
                                });
                            }
                        }
                    });
                });
            });
            
            // Sort by match score
            allMatches.sort((a, b) => b.score - a.score);
            
            displayMatchingResults(allMatches, 'جميع المناطق');
        }

        function calculateMatchScore(seller, buyer) {
            let score = 0;
            
            // Same property type
            if (seller.propertyType === buyer.propertyType) {
                score += 50;
            }
            
            // Same location
            if (seller.location === buyer.location) {
                score += 30;
            }
            
            // Price compatibility (if available)
            if (seller.totalPrice && buyer.budget) {
                const priceDiff = Math.abs(seller.totalPrice - buyer.budget) / seller.totalPrice;
                if (priceDiff <= 0.1) score += 20; // Within 10%
                else if (priceDiff <= 0.2) score += 10; // Within 20%
            }
            
            return score;
        }

        function displayMatchingResults(matches, locationName) {
            const resultsContainer = document.getElementById('matching-results');
            
            resultsContainer.innerHTML = `
                <div class="mb-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">نتائج التوفيق - ${locationName}</h4>
                    <div class="bg-green-50 p-4 rounded-lg text-center mb-6">
                        <div class="text-3xl font-bold text-green-600">${matches.length}</div>
                        <div class="text-sm text-gray-600">توافق محتمل</div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    ${matches.length > 0 ? matches.map((match, index) => `
                        <div class="bg-white p-6 rounded-xl border-2 border-green-200 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-4">
                                <h5 class="text-lg font-bold text-green-700">توافق #${index + 1}</h5>
                                <div class="flex items-center gap-2">
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">نسبة التوافق: ${match.score}%</span>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">${getLocationArabic(match.location)}</span>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Seller Info -->
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h6 class="font-bold text-green-700 mb-2">🏠 البائع</h6>
                                    <p class="text-sm text-gray-600 mb-1"><strong>النوع:</strong> ${getPropertyTypeArabic(match.seller.propertyType)}</p>
                                    <p class="text-sm text-gray-600 mb-1"><strong>الاسم:</strong> ${match.seller.name}</p>
                                    <p class="text-sm text-gray-600 mb-1"><strong>الواتساب:</strong> ${match.seller.whatsapp}</p>
                                    ${match.seller.area ? `<p class="text-sm text-gray-600 mb-1"><strong>المساحة:</strong> ${match.seller.area} م²</p>` : ''}
                                    ${match.seller.totalPrice ? `<p class="text-sm font-bold text-green-600"><strong>السعر:</strong> ${Number(match.seller.totalPrice).toLocaleString()} جنيه</p>` : ''}
                                </div>
                                
                                <!-- Buyer Info -->
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h6 class="font-bold text-blue-700 mb-2">🔍 المشتري</h6>
                                    <p class="text-sm text-gray-600 mb-1"><strong>يبحث عن:</strong> ${getPropertyTypeArabic(match.buyer.propertyType)}</p>
                                    <p class="text-sm text-gray-600 mb-1"><strong>الاسم:</strong> ${match.buyer.name}</p>
                                    <p class="text-sm text-gray-600 mb-1"><strong>الواتساب:</strong> ${match.buyer.whatsapp}</p>
                                </div>
                            </div>
                            
                            <div class="mt-4 flex gap-3 justify-center">
                                <button onclick="contactBoth('${match.seller.whatsapp}', '${match.buyer.whatsapp}')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">تواصل مع الطرفين</button>
                                <button onclick="createInquiry(${match.seller.id}, ${match.buyer.id})" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">إنشاء استعلام</button>
                                <button onclick="scheduleViewing(${match.seller.id}, ${match.buyer.id})" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">تحديد موعد معاينة</button>
                            </div>
                        </div>
                    `).join('') : '<p class="text-center text-gray-500 py-8">لا توجد توافقات في هذه المنطقة</p>'}
                </div>
            `;
        }

        function contactBoth(sellerWhatsapp, buyerWhatsapp) {
            const sellerMessage = encodeURIComponent('مرحباً، لدينا عميل مهتم بعقارك المعروض للبيع على موقع المستقبل للتسويق العقاري');
            const buyerMessage = encodeURIComponent('مرحباً، وجدنا عقار قد يناسب طلبك على موقع المستقبل للتسويق العقاري');
            
            const sellerLink = `https://wa.me/2${sellerWhatsapp}?text=${sellerMessage}`;
            const buyerLink = `https://wa.me/2${buyerWhatsapp}?text=${buyerMessage}`;
            
            // Open both links
            window.open(sellerLink, '_blank');
            setTimeout(() => {
                window.open(buyerLink, '_blank');
            }, 1000);
            
            showCustomAlert('تم فتح الروابط', 'تم فتح روابط الواتساب للطرفين في نوافذ جديدة');
        }

        // Function to view property images
        function viewPropertyImages(sellerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            if (!seller || !seller.images || seller.images.length === 0) {
                showCustomAlert('لا توجد صور', 'لا توجد صور مرفقة لهذا العقار');
                return;
            }
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">صور العقار - ${getPropertyTypeArabic(seller.propertyType)}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${seller.images.map((image, index) => `
                            <div class="relative group">
                                <img src="${image.data}" alt="صورة العقار ${index + 1}" class="w-full h-48 object-cover rounded-lg border-2 border-gray-300 cursor-pointer hover:border-blue-500 transition-colors" onclick="openImageFullscreen('${image.data}')">
                                <div class="absolute bottom-2 left-2 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-xs">
                                    صورة ${index + 1}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-sm text-gray-600">إجمالي الصور: ${seller.images.length}</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        // Function to open image in fullscreen
        function openImageFullscreen(imageSrc) {
            const fullscreenDiv = document.createElement('div');
            fullscreenDiv.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 cursor-pointer';
            fullscreenDiv.innerHTML = `
                <img src="${imageSrc}" alt="صورة العقار" class="max-w-full max-h-full object-contain">
                <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 text-white text-3xl hover:text-gray-300">&times;</button>
            `;
            fullscreenDiv.onclick = function(e) {
                if (e.target === fullscreenDiv) {
                    fullscreenDiv.remove();
                }
            };
            document.body.appendChild(fullscreenDiv);
        }

        function submitBuyerForm(event) {
            event.preventDefault();
            
            const whatsappNumber = document.getElementById('buyer-whatsapp').value;
            if (!validateWhatsApp(whatsappNumber)) {
                showCustomAlert('خطأ', 'رقم الواتساب غير صحيح. يجب أن يبدأ بـ 010, 011, 012, أو 015 ويتكون من 11 رقم');
                return;
            }
            
            if (!currentBuyerPropertyType) {
                showCustomAlert('خطأ', 'يرجى اختيار نوع العقار المطلوب');
                return;
            }
            
            // Collect form data
            const formData = {
                id: Date.now(),
                type: 'buyer',
                propertyType: currentBuyerPropertyType,
                location: document.getElementById('buyer-location').value,
                name: document.getElementById('buyer-name').value,
                whatsapp: whatsappNumber,
                timestamp: new Date().toLocaleString('ar-EG')
            };
            
            // Save to registrations
            buyerRegistrations.push(formData);
            
            // Update admin panel
            updateAdminPanel();
            
            // Update listings
            updateListings();
            
            showCustomAlert('تم بنجاح', 'تم تسجيل طلب البحث بنجاح! سيتم التواصل معك عند توفر عقار مناسب.');
            
            // Reset form
            document.getElementById('buyer-form').reset();
            currentBuyerPropertyType = '';
            document.querySelectorAll('.buyer-property-type-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-100');
                btn.classList.add('border-gray-300');
            });
        }

        function collectPropertyData(type) {
            const data = {};
            
            // Common fields
            const areaField = document.getElementById(`${type}-area`) || document.getElementById(`${type}-area-meters`);
            if (areaField) data.area = areaField.value;
            
            const yearField = document.getElementById(`${type}-year`);
            if (yearField) data.year = yearField.value;
            
            const pricePerMeterField = document.getElementById(`${type}-price-per-meter`);
            if (pricePerMeterField) data.pricePerMeter = pricePerMeterField.value;
            
            const totalPriceField = document.getElementById(`${type}-total-price`);
            if (totalPriceField) data.totalPrice = totalPriceField.value;
            
            const negotiableField = document.getElementById(`${type}-negotiable`);
            if (negotiableField) data.negotiable = negotiableField.checked;
            
            // Type-specific fields
            switch(type) {
                case 'apartment':
                    data.rooms = document.getElementById('apartment-rooms').value;
                    data.bathrooms = document.getElementById('apartment-bathrooms').value;
                    data.floor = document.getElementById('apartment-floor').value;
                    data.finishing = document.getElementById('apartment-finishing').value;
                    data.apartmentShare = document.getElementById('apartment-share').value;
                    break;
                case 'house':
                    data.floors = document.getElementById('house-floors').value;
                    data.apartmentsPerFloor = document.getElementById('house-apartments-per-floor').value;
                    data.apartmentArea = document.getElementById('house-apartment-area').value;
                    data.finishing = document.getElementById('house-finishing').value;
                    break;
                case 'land':
                    data.landType = document.getElementById('land-type').value;
                    data.areaQirat = document.getElementById('land-area-qirat').value;
                    data.licensed = document.getElementById('land-licensed').value;
                    break;
                case 'villa':
                    data.floors = document.getElementById('villa-floors').value;
                    data.facilities = document.getElementById('villa-facilities').value;
                    data.furnished = document.getElementById('villa-furnished').value;
                    data.areaQirat = document.getElementById('villa-area-qirat').value;
                    break;
            }
            
            return data;
        }

        function updateAdminPanel() {
            const sellersContainer = document.getElementById('admin-sellers');
            const buyersContainer = document.getElementById('admin-buyers');
            
            // Update sellers
            sellersContainer.innerHTML = sellerRegistrations.map(seller => `
                <div class="bg-white p-4 rounded-lg border border-green-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-bold text-green-700">${getPropertyTypeArabic(seller.propertyType)} للبيع</h4>
                        <span class="text-xs text-gray-500">${seller.timestamp}</span>
                    </div>
                    
                    <!-- البيانات الأساسية -->
                    <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                        <p class="text-gray-600">📍 ${getLocationArabic(seller.location)}</p>
                        <p class="text-gray-600">👤 ${seller.name}</p>
                        <p class="text-gray-600">📱 ${seller.whatsapp}</p>
                        ${seller.area ? `<p class="text-gray-600">📐 ${seller.area} م²</p>` : ''}
                        ${seller.rooms ? `<p class="text-gray-600">🏠 ${seller.rooms} غرف</p>` : ''}
                        ${seller.floors ? `<p class="text-gray-600">🏢 ${seller.floors} أدوار</p>` : ''}
                        ${seller.year ? `<p class="text-gray-600">🏗️ مباني ${seller.year}</p>` : ''}
                        ${seller.finishing ? `<p class="text-gray-600">🎨 ${getFinishingArabic(seller.finishing)}</p>` : ''}
                        ${seller.apartmentShare ? `<p class="text-gray-600">📊 حصة: ${seller.apartmentShare}</p>` : ''}
                        ${seller.floor ? `<p class="text-gray-600">🏠 الدور: ${getFloorArabic(seller.floor)}</p>` : ''}
                    </div>
                    
                    ${seller.mapLocation ? `<p class="text-sm text-gray-600 mb-2">🗺️ ${seller.mapLocation}</p>` : ''}
                    
                    <!-- السعر -->
                    <div class="mb-3 p-2 bg-green-50 rounded">
                        ${seller.pricePerMeter ? `<p class="text-sm text-gray-600">سعر المتر: ${Number(seller.pricePerMeter).toLocaleString()} جنيه</p>` : ''}
                        ${seller.totalPrice ? `<p class="text-lg font-bold text-green-600">💰 ${Number(seller.totalPrice).toLocaleString()} جنيه</p>` : ''}
                        ${seller.negotiable ? `<p class="text-xs text-amber-600 font-semibold">⚠️ قابل للتفاوض</p>` : ''}
                    </div>
                    
                    ${seller.images && seller.images.length > 0 ? `<p class="text-xs text-blue-600 font-semibold mb-2">📷 ${seller.images.length} صورة مرفقة</p>` : ''}
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="viewFullDetails(${seller.id}, 'seller')" class="text-xs bg-indigo-500 text-white px-3 py-1 rounded hover:bg-indigo-600 transition-colors">عرض التفاصيل الكاملة</button>
                        <button onclick="generatePropertyCard(${seller.id})" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">إنشاء مقطف</button>
                        ${seller.images && seller.images.length > 0 ? `<button onclick="viewPropertyImages(${seller.id})" class="text-xs bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 transition-colors">عرض الصور</button>` : ''}
                        <button onclick="editSellerData(${seller.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">تعديل</button>
                        <button onclick="deleteRegistration('seller', ${seller.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">حذف</button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-8">لا توجد تسجيلات بائعين حتى الآن</p>';
            
            // Update buyers
            buyersContainer.innerHTML = buyerRegistrations.map(buyer => `
                <div class="bg-white p-4 rounded-lg border border-blue-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-blue-700">مطلوب ${getPropertyTypeArabic(buyer.propertyType)}</h4>
                        <span class="text-xs text-gray-500">${buyer.timestamp}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">📍 ${getLocationArabic(buyer.location)}</p>
                    <p class="text-sm text-gray-600 mb-1">👤 ${buyer.name}</p>
                    <p class="text-sm text-gray-600 mb-1">📱 ${buyer.whatsapp}</p>
                    <div class="mt-3 flex gap-2 flex-wrap">
                        <button onclick="copyWhatsAppLink('${buyer.whatsapp}', 'buyer')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">نسخ رابط واتساب</button>
                        <button onclick="editBuyerData(${buyer.id})" class="text-xs bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition-colors">تعديل البيانات</button>
                        <button onclick="deleteRegistration('buyer', ${buyer.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">حذف</button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-8">لا توجد طلبات مشترين حتى الآن</p>';
            
            // Update statistics
            updateStatistics();
        }

        function updateListings() {
            const saleListings = document.getElementById('sale-listings');
            const wantedListings = document.getElementById('wanted-listings');
            
            // Update sale listings
            saleListings.innerHTML = sellerRegistrations.map(seller => `
                <div class="border-2 border-green-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-lg text-gray-800">${getPropertyTypeArabic(seller.propertyType)} للبيع</h4>
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">للبيع</span>
                    </div>
                    
                    ${seller.images && seller.images.length >= 2 ? `
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <img src="${seller.images[0].data}" alt="صورة العقار 1" class="w-full h-24 object-cover rounded-lg border cursor-pointer hover:opacity-75" onclick="openImageFullscreen('${seller.images[0].data}')">
                        <img src="${seller.images[1].data}" alt="صورة العقار 2" class="w-full h-24 object-cover rounded-lg border cursor-pointer hover:opacity-75" onclick="openImageFullscreen('${seller.images[1].data}')">
                    </div>
                    ` : seller.images && seller.images.length === 1 ? `
                    <div class="mb-3">
                        <img src="${seller.images[0].data}" alt="صورة العقار" class="w-full h-32 object-cover rounded-lg border cursor-pointer hover:opacity-75" onclick="openImageFullscreen('${seller.images[0].data}')">
                    </div>
                    ` : ''}
                    
                    <p class="text-gray-600 mb-2">📍 ${getLocationArabic(seller.location)}</p>
                    ${seller.area ? `<p class="text-gray-600 mb-2">📐 المساحة: ${seller.area} متر مربع</p>` : ''}
                    ${seller.rooms ? `<p class="text-gray-600 mb-2">🏠 ${seller.rooms} غرف</p>` : ''}
                    ${seller.year ? `<p class="text-gray-600 mb-2">🏗️ مباني ${seller.year}</p>` : ''}
                    ${seller.images && seller.images.length > 2 ? `<p class="text-xs text-blue-600 mb-2">📷 ${seller.images.length} صور متاحة</p>` : ''}
                    <div class="flex justify-between items-center mt-4">
                        <div>
                            ${seller.pricePerMeter ? `<p class="text-sm text-gray-500">سعر المتر: ${Number(seller.pricePerMeter).toLocaleString()} جنيه</p>` : ''}
                            ${seller.totalPrice ? `<p class="text-xl font-bold text-green-600">السعر الكلي: ${Number(seller.totalPrice).toLocaleString()} جنيه</p>` : ''}
                            ${seller.negotiable ? `<p class="text-sm text-amber-600 font-semibold">قابل للتفاوض</p>` : ''}
                        </div>
                        <button onclick="copyCompanyWhatsAppLink()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">تواصل معنا عبر واتساب</button>
                    </div>
                </div>
            `).join('');
            
            // Update wanted listings
            wantedListings.innerHTML = buyerRegistrations.map(buyer => `
                <div class="border-2 border-blue-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-lg text-gray-800">مطلوب ${getPropertyTypeArabic(buyer.propertyType)}</h4>
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">مطلوب</span>
                    </div>
                    <p class="text-gray-600 mb-2">📍 ${getLocationArabic(buyer.location)}</p>
                    <div class="flex justify-between items-center mt-4">
                        <div>
                            <p class="text-xl font-bold text-blue-600">يبحث عن عقار مناسب</p>
                        </div>
                        <button onclick="copyCompanyWhatsAppLink()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">تواصل معنا عبر واتساب</button>
                    </div>
                </div>
            `).join('');
        }

        function getPropertyTypeArabic(type) {
            const types = {
                'apartment': 'شقة',
                'house': 'بيت',
                'land': 'أرض',
                'shop': 'محل',
                'office': 'مكتب تجاري',
                'villa': 'فيلا',
                'building-land': 'أرض مباني'
            };
            return types[type] || type;
        }

        function getLocationArabic(location) {
            const locations = {
                'damanhour': 'دمنهور',
                'kom-hamada': 'كوم حمادة',
                'itay': 'إيتاي البارود',
                'delengat': 'الدلنجات'
            };
            return locations[location] || location;
        }

        function copyWhatsAppLink(whatsapp, type) {
            let message = '';
            if (type === 'seller') {
                message = encodeURIComponent('مرحباً، أنا مهتم بالعقار المعروض للبيع على موقع المستقبل للتسويق العقاري');
            } else {
                message = encodeURIComponent('مرحباً، لدي عقار قد يناسب طلبك على موقع المستقبل للتسويق العقاري');
            }
            
            const whatsappLink = `https://wa.me/2${whatsapp}?text=${message}`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(whatsappLink).then(() => {
                showCustomAlert('تم النسخ', 'تم نسخ رابط الواتساب بنجاح! يمكنك الآن لصقه في أي مكان');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = whatsappLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCustomAlert('تم النسخ', 'تم نسخ رابط الواتساب بنجاح! يمكنك الآن لصقه في أي مكان');
            });
        }

        function editSellerData(sellerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            if (!seller) return;
            
            showEditSellerModal(seller);
        }

        function editBuyerData(buyerId) {
            const buyer = buyerRegistrations.find(b => b.id === buyerId);
            if (!buyer) return;
            
            showEditBuyerModal(buyer);
        }

        function showEditSellerModal(seller) {
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-96 overflow-y-auto">
                    <h3 class="text-xl font-bold text-green-700 mb-4">تعديل بيانات البائع</h3>
                    <form onsubmit="updateSellerData(event, ${seller.id})">
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الاسم</label>
                                <input type="text" id="edit-seller-name" value="${seller.name}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                                <input type="tel" id="edit-seller-whatsapp" value="${seller.whatsapp}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المنطقة</label>
                                <select id="edit-seller-location" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                    <option value="damanhour" ${seller.location === 'damanhour' ? 'selected' : ''}>دمنهور</option>
                                    <option value="kom-hamada" ${seller.location === 'kom-hamada' ? 'selected' : ''}>كوم حمادة</option>
                                    <option value="itay" ${seller.location === 'itay' ? 'selected' : ''}>إيتاي البارود</option>
                                    <option value="delengat" ${seller.location === 'delengat' ? 'selected' : ''}>الدلنجات</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المساحة (متر مربع)</label>
                                <input type="number" id="edit-seller-area" value="${seller.area || ''}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">سعر المتر (جنيه)</label>
                                <input type="number" id="edit-seller-price-per-meter" value="${seller.pricePerMeter || ''}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">السعر الكلي (جنيه)</label>
                                <input type="number" id="edit-seller-total-price" value="${seller.totalPrice || ''}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">موقع العقار بالتفصيل</label>
                            <input type="text" id="edit-seller-map-location" value="${seller.mapLocation || ''}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" placeholder="اكتب اسم المكان بالتفصيل">
                        </div>
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">حفظ التعديلات</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function showEditBuyerModal(buyer) {
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-96 overflow-y-auto">
                    <h3 class="text-xl font-bold text-blue-700 mb-4">تعديل بيانات المشتري</h3>
                    <form onsubmit="updateBuyerData(event, ${buyer.id})">
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الاسم</label>
                                <input type="text" id="edit-buyer-name" value="${buyer.name}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                                <input type="tel" id="edit-buyer-whatsapp" value="${buyer.whatsapp}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المنطقة المطلوبة</label>
                                <select id="edit-buyer-location" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                                    <option value="damanhour" ${buyer.location === 'damanhour' ? 'selected' : ''}>دمنهور</option>
                                    <option value="kom-hamada" ${buyer.location === 'kom-hamada' ? 'selected' : ''}>كوم حمادة</option>
                                    <option value="itay" ${buyer.location === 'itay' ? 'selected' : ''}>إيتاي البارود</option>
                                    <option value="delengat" ${buyer.location === 'delengat' ? 'selected' : ''}>الدلنجات</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نوع العقار المطلوب</label>
                                <select id="edit-buyer-property-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" required>
                                    <option value="apartment" ${buyer.propertyType === 'apartment' ? 'selected' : ''}>شقة</option>
                                    <option value="house" ${buyer.propertyType === 'house' ? 'selected' : ''}>بيت</option>
                                    <option value="land" ${buyer.propertyType === 'land' ? 'selected' : ''}>أرض</option>
                                    <option value="shop" ${buyer.propertyType === 'shop' ? 'selected' : ''}>محل</option>
                                    <option value="office" ${buyer.propertyType === 'office' ? 'selected' : ''}>مكتب</option>
                                    <option value="villa" ${buyer.propertyType === 'villa' ? 'selected' : ''}>فيلا</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">حفظ التعديلات</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function updateSellerData(event, sellerId) {
            event.preventDefault();
            
            const sellerIndex = sellerRegistrations.findIndex(s => s.id === sellerId);
            if (sellerIndex === -1) return;
            
            // Update seller data
            sellerRegistrations[sellerIndex].name = document.getElementById('edit-seller-name').value;
            sellerRegistrations[sellerIndex].whatsapp = document.getElementById('edit-seller-whatsapp').value;
            sellerRegistrations[sellerIndex].location = document.getElementById('edit-seller-location').value;
            sellerRegistrations[sellerIndex].area = document.getElementById('edit-seller-area').value;
            sellerRegistrations[sellerIndex].pricePerMeter = document.getElementById('edit-seller-price-per-meter').value;
            sellerRegistrations[sellerIndex].totalPrice = document.getElementById('edit-seller-total-price').value;
            sellerRegistrations[sellerIndex].mapLocation = document.getElementById('edit-seller-map-location').value;
            
            // Update displays
            updateAdminPanel();
            updateListings();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم التحديث', 'تم تحديث بيانات البائع بنجاح');
        }

        function updateBuyerData(event, buyerId) {
            event.preventDefault();
            
            const buyerIndex = buyerRegistrations.findIndex(b => b.id === buyerId);
            if (buyerIndex === -1) return;
            
            // Update buyer data
            buyerRegistrations[buyerIndex].name = document.getElementById('edit-buyer-name').value;
            buyerRegistrations[buyerIndex].whatsapp = document.getElementById('edit-buyer-whatsapp').value;
            buyerRegistrations[buyerIndex].location = document.getElementById('edit-buyer-location').value;
            buyerRegistrations[buyerIndex].propertyType = document.getElementById('edit-buyer-property-type').value;
            
            // Update displays
            updateAdminPanel();
            updateListings();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم التحديث', 'تم تحديث بيانات المشتري بنجاح');
        }



        function deleteRegistration(type, id) {
            showCustomConfirm('حذف التسجيل', 'هل أنت متأكد من حذف هذا التسجيل؟', () => {
                if (type === 'seller') {
                    sellerRegistrations = sellerRegistrations.filter(s => s.id !== id);
                } else {
                    buyerRegistrations = buyerRegistrations.filter(b => b.id !== id);
                }
                updateAdminPanel();
                updateListings();
                showCustomAlert('تم الحذف', 'تم حذف التسجيل بنجاح');
            });
        }

        function showCustomAlert(title, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            alertDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${title}</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">موافق</button>
                </div>
            `;
            document.body.appendChild(alertDiv);
        }

        function showCustomConfirm(title, message, onConfirm) {
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">${title}</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <div class="flex gap-4 justify-center">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                        <button onclick="(${onConfirm})(); this.closest('.fixed').remove()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">تأكيد</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
        }

        // Event listener for land type change
        document.addEventListener('change', function(e) {
            if (e.target.id === 'land-licensed') {
                const buildingYearDiv = document.getElementById('building-license-year');
                if (e.target.value === 'yes') {
                    buildingYearDiv.style.display = 'block';
                } else {
                    buildingYearDiv.style.display = 'none';
                }
            }
        });

        // Image upload functionality
        document.addEventListener('change', function(e) {
            if (e.target.id === 'property-images') {
                handleImageUpload(e.target.files);
            }
        });

        function handleImageUpload(files) {
            const previewContainer = document.getElementById('image-preview');
            const countContainer = document.getElementById('image-count');
            
            if (files.length < 4) {
                showCustomAlert('عدد الصور غير كافي', 'يجب اختيار 4 صور على الأقل للعقار');
                return;
            }
            
            if (files.length > 10) {
                showCustomAlert('عدد الصور كثير', 'الحد الأقصى هو 10 صور للعقار');
                return;
            }
            
            previewContainer.innerHTML = '';
            previewContainer.classList.remove('hidden');
            countContainer.classList.remove('hidden');
            
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'relative group';
                        imageDiv.innerHTML = `
                            <img src="${e.target.result}" alt="صورة العقار ${index + 1}" class="w-full h-24 object-cover rounded-lg border-2 border-gray-300">
                            <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center">
                                <span class="text-white text-xs font-semibold">صورة ${index + 1}</span>
                            </div>
                        `;
                        previewContainer.appendChild(imageDiv);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            countContainer.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-green-600 font-semibold">✅ تم اختيار ${files.length} صورة</span>
                    <span class="text-xs text-gray-500">الحد الأقصى: 10 صور</span>
                </div>
            `;
        }

        // Map functionality
        function showMap(area) {
            // Hide all maps first
            document.querySelectorAll('.map-iframe').forEach(map => {
                map.classList.add('hidden');
            });
            
            // Hide default message
            document.getElementById('default-map-message').classList.add('hidden');
            
            // Show selected map
            document.getElementById(`${area}-map`).classList.remove('hidden');
            
            // Update button styles
            document.querySelectorAll('.map-area-btn').forEach(btn => {
                btn.classList.remove('bg-green-500', 'text-white');
                btn.classList.add('bg-blue-500', 'text-white');
            });
            
            // Highlight selected button
            event.target.classList.remove('bg-blue-500');
            event.target.classList.add('bg-green-500');
            
            // Show selected area display
            const areaDisplay = document.getElementById('selected-area-display');
            const areaName = document.getElementById('area-name');
            const coordinatesDiv = document.getElementById('selected-coordinates');
            
            areaDisplay.classList.remove('hidden');
            areaName.textContent = getLocationArabic(area);
            
            coordinatesDiv.classList.remove('hidden');
            coordinatesDiv.innerHTML = `📍 تم عرض خريطة: ${getLocationArabic(area)} - انقر على المناطق الفرعية لتحديد الموقع`;
            
            // Update the location input field
            const locationSelect = document.getElementById('seller-location');
            if (locationSelect) {
                locationSelect.value = area;
            }
        }

        // Function to select specific map location
        function selectMapLocation(location) {
            const mapLocationInput = document.getElementById('map-location');
            if (mapLocationInput) {
                mapLocationInput.value = location;
            }
            
            // Update coordinates display
            const coordinatesDiv = document.getElementById('selected-coordinates');
            if (coordinatesDiv) {
                coordinatesDiv.innerHTML = `✅ تم تحديد الموقع: ${location}`;
                coordinatesDiv.classList.remove('hidden');
            }
            
            // Show success message
            showCustomAlert('تم تحديد الموقع', `تم تحديد موقع العقار: ${location}`);
        }

        // Legacy function for backward compatibility
        function selectMapArea(area) {
            showMap(area);
        }

        // Helper functions for Arabic translations
        function getFinishingArabic(finishing) {
            const finishings = {
                'finished': 'متشطب كامل',
                'semi-finished': 'نصف تشطيب',
                'unfinished': 'على الطوبة'
            };
            return finishings[finishing] || finishing;
        }

        function getFloorArabic(floor) {
            const floors = {
                'ground': 'الأرضي',
                '1': 'الأول',
                '2': 'الثاني',
                '3': 'الثالث',
                '4': 'الرابع',
                '5+': 'الخامس أو أعلى'
            };
            return floors[floor] || floor;
        }

        // View full details function
        function viewFullDetails(id, type) {
            const item = type === 'seller' ? sellerRegistrations.find(s => s.id === id) : buyerRegistrations.find(b => b.id === id);
            if (!item) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">التفاصيل الكاملة - ${getPropertyTypeArabic(item.propertyType)}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- البيانات الأساسية -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-700 mb-3">البيانات الأساسية</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>نوع العقار:</strong> ${getPropertyTypeArabic(item.propertyType)}</p>
                                <p><strong>المنطقة:</strong> ${getLocationArabic(item.location)}</p>
                                <p><strong>اسم المالك:</strong> ${item.name}</p>
                                <p><strong>رقم الواتساب:</strong> ${item.whatsapp}</p>
                                <p><strong>تاريخ التسجيل:</strong> ${item.timestamp}</p>
                                ${item.mapLocation ? `<p><strong>الموقع بالتفصيل:</strong> ${item.mapLocation}</p>` : ''}
                            </div>
                        </div>
                        
                        <!-- تفاصيل العقار -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-700 mb-3">تفاصيل العقار</h4>
                            <div class="space-y-2 text-sm">
                                ${item.area ? `<p><strong>المساحة:</strong> ${item.area} متر مربع</p>` : ''}
                                ${item.rooms ? `<p><strong>عدد الغرف:</strong> ${item.rooms}</p>` : ''}
                                ${item.bathrooms ? `<p><strong>عدد الحمامات:</strong> ${item.bathrooms}</p>` : ''}
                                ${item.floors ? `<p><strong>عدد الأدوار:</strong> ${item.floors}</p>` : ''}
                                ${item.floor ? `<p><strong>الدور:</strong> ${getFloorArabic(item.floor)}</p>` : ''}
                                ${item.apartmentShare ? `<p><strong>حصة الشقة:</strong> ${item.apartmentShare}</p>` : ''}
                                ${item.year ? `<p><strong>سنة المباني:</strong> ${item.year}</p>` : ''}
                                ${item.finishing ? `<p><strong>مستوى التشطيب:</strong> ${getFinishingArabic(item.finishing)}</p>` : ''}
                                ${item.apartmentsPerFloor ? `<p><strong>شقق في الدور:</strong> ${item.apartmentsPerFloor}</p>` : ''}
                                ${item.apartmentArea ? `<p><strong>مساحة الشقة:</strong> ${item.apartmentArea} م²</p>` : ''}
                            </div>
                        </div>
                        
                        <!-- معلومات السعر -->
                        ${type === 'seller' && (item.pricePerMeter || item.totalPrice) ? `
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-700 mb-3">معلومات السعر</h4>
                            <div class="space-y-2 text-sm">
                                ${item.pricePerMeter ? `<p><strong>سعر المتر:</strong> ${Number(item.pricePerMeter).toLocaleString()} جنيه</p>` : ''}
                                ${item.totalPrice ? `<p><strong>السعر الكلي:</strong> ${Number(item.totalPrice).toLocaleString()} جنيه</p>` : ''}
                                ${item.negotiable ? `<p class="text-amber-600 font-semibold">⚠️ قابل للتفاوض</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- الصور -->
                        ${item.images && item.images.length > 0 ? `
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-700 mb-3">الصور المرفقة (${item.images.length})</h4>
                            <div class="grid grid-cols-3 gap-2">
                                ${item.images.slice(0, 6).map((image, index) => `
                                    <img src="${image.data}" alt="صورة ${index + 1}" class="w-full h-16 object-cover rounded border cursor-pointer hover:opacity-75" onclick="openImageFullscreen('${image.data}')">
                                `).join('')}
                                ${item.images.length > 6 ? `<div class="w-full h-16 bg-gray-200 rounded border flex items-center justify-center text-xs text-gray-600">+${item.images.length - 6} صور أخرى</div>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="mt-6 flex gap-4 justify-center">
                        <button onclick="copyWhatsAppLink('${item.whatsapp}', '${type}')" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">نسخ رابط واتساب</button>
                        ${type === 'seller' ? `<button onclick="generatePropertyCard(${item.id})" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">إنشاء مقطف</button>` : ''}
                        <button onclick="editSellerData(${item.id})" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">تعديل البيانات</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        // Generate property card function
        function generatePropertyCard(sellerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            if (!seller) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-purple-700">إنشاء وتخصيص مقطف العقار</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Customization Panel -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h4 class="text-lg font-bold text-gray-700 mb-4">🎨 تخصيص المقطف</h4>
                            
                            <!-- Title Customization -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">عنوان المقطف</label>
                                <input type="text" id="card-title" value="${getPropertyTypeArabic(seller.propertyType)} للبيع" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" onchange="updateCardPreview()">
                            </div>
                            
                            <!-- Location Customization -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الموقع المعروض</label>
                                <input type="text" id="card-location" value="${getLocationArabic(seller.location)}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" onchange="updateCardPreview()">
                            </div>
                            
                            <!-- Additional Notes -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ملاحظات إضافية</label>
                                <textarea id="card-notes" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none h-20" placeholder="اكتب أي ملاحظات أو مميزات إضافية..." onchange="updateCardPreview()"></textarea>
                            </div>
                            
                            <!-- Special Features -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">المميزات الخاصة</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="feature-urgent" class="mr-2" onchange="updateCardPreview()">
                                        <span class="text-sm">🔥 عرض عاجل</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="feature-exclusive" class="mr-2" onchange="updateCardPreview()">
                                        <span class="text-sm">⭐ حصري</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="feature-new" class="mr-2" onchange="updateCardPreview()">
                                        <span class="text-sm">🆕 جديد</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="feature-reduced" class="mr-2" onchange="updateCardPreview()">
                                        <span class="text-sm">💸 سعر مخفض</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Contact Info Customization -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">رقم التواصل</label>
                                <input type="text" id="card-contact" value="01091020887" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" onchange="updateCardPreview()">
                            </div>
                            
                            <!-- Additional Details -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">تفاصيل إضافية</label>
                                <div class="space-y-2">
                                    <input type="text" id="extra-detail-1" placeholder="تفصيل إضافي 1" class="w-full p-2 border border-gray-300 rounded focus:border-purple-500 focus:outline-none text-sm" onchange="updateCardPreview()">
                                    <input type="text" id="extra-detail-2" placeholder="تفصيل إضافي 2" class="w-full p-2 border border-gray-300 rounded focus:border-purple-500 focus:outline-none text-sm" onchange="updateCardPreview()">
                                    <input type="text" id="extra-detail-3" placeholder="تفصيل إضافي 3" class="w-full p-2 border border-gray-300 rounded focus:border-purple-500 focus:outline-none text-sm" onchange="updateCardPreview()">
                                </div>
                            </div>
                            
                            <!-- Card Style -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نمط المقطف</label>
                                <select id="card-style" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" onchange="updateCardPreview()">
                                    <option value="classic">كلاسيكي</option>
                                    <option value="modern">عصري</option>
                                    <option value="elegant">أنيق</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Property Card Preview -->
                        <div id="property-card-preview" class="bg-gradient-to-br from-blue-50 to-green-50 p-6 rounded-xl border-2 border-gray-300">
                            <div class="text-center mb-4">
                                <div id="card-badges" class="mb-2">
                                    <!-- Special badges will appear here -->
                                </div>
                                <h2 id="preview-title" class="text-2xl font-bold text-gray-800 mb-2">${getPropertyTypeArabic(seller.propertyType)} للبيع</h2>
                                <p id="preview-location" class="text-lg text-blue-600 font-semibold">📍 ${getLocationArabic(seller.location)}</p>
                            </div>
                            
                            <!-- Images Section -->
                            ${seller.images && seller.images.length >= 2 ? `
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <img src="${seller.images[0].data}" alt="صورة العقار 1" class="w-full h-32 object-cover rounded-lg border-2 border-gray-300">
                                <img src="${seller.images[1].data}" alt="صورة العقار 2" class="w-full h-32 object-cover rounded-lg border-2 border-gray-300">
                            </div>
                            ` : seller.images && seller.images.length === 1 ? `
                            <div class="mb-4">
                                <img src="${seller.images[0].data}" alt="صورة العقار" class="w-full h-40 object-cover rounded-lg border-2 border-gray-300">
                            </div>
                            ` : ''}
                            
                            <!-- Property Details -->
                            <div class="grid grid-cols-2 gap-3 mb-4 text-sm">
                                ${seller.area ? `<div class="bg-white p-2 rounded border"><strong>المساحة:</strong> ${seller.area} م²</div>` : ''}
                                ${seller.rooms ? `<div class="bg-white p-2 rounded border"><strong>الغرف:</strong> ${seller.rooms}</div>` : ''}
                                ${seller.apartmentShare ? `<div class="bg-white p-2 rounded border"><strong>الحصة:</strong> ${seller.apartmentShare}</div>` : ''}
                                ${seller.year ? `<div class="bg-white p-2 rounded border"><strong>المباني:</strong> ${seller.year}</div>` : ''}
                                ${seller.finishing ? `<div class="bg-white p-2 rounded border"><strong>التشطيب:</strong> ${getFinishingArabic(seller.finishing)}</div>` : ''}
                                ${seller.floor ? `<div class="bg-white p-2 rounded border"><strong>الدور:</strong> ${getFloorArabic(seller.floor)}</div>` : ''}
                            </div>
                            
                            <!-- Extra Details -->
                            <div id="extra-details" class="mb-4">
                                <!-- Extra details will appear here -->
                            </div>
                            
                            <!-- Price Section -->
                            <div class="bg-white p-4 rounded-lg border-2 border-green-300 mb-4">
                                ${seller.pricePerMeter ? `<p class="text-sm text-gray-600 mb-1">سعر المتر: ${Number(seller.pricePerMeter).toLocaleString()} جنيه</p>` : ''}
                                ${seller.totalPrice ? `<p class="text-xl font-bold text-green-600">💰 السعر: ${Number(seller.totalPrice).toLocaleString()} جنيه</p>` : ''}
                                ${seller.negotiable ? `<p class="text-sm text-amber-600 font-semibold">⚠️ قابل للتفاوض</p>` : ''}
                            </div>
                            
                            <!-- Additional Notes -->
                            <div id="card-notes-preview" class="mb-4" style="display: none;">
                                <div class="bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                                    <p class="text-sm text-gray-700"><strong>ملاحظات:</strong> <span id="notes-text"></span></p>
                                </div>
                            </div>
                            
                            <!-- Contact Section -->
                            <div class="bg-blue-100 p-4 rounded-lg text-center">
                                <p class="text-lg font-bold text-blue-800 mb-2">للتواصل عبر واتساب</p>
                                <p id="preview-contact" class="text-xl font-bold text-blue-900">📱 01091020887</p>
                                <button onclick="copyPropertyCardWhatsApp()" class="mt-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">نسخ رابط واتساب</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-4 justify-center mt-6">
                        <button onclick="copyPropertyCard()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">📋 نسخ المقطف</button>
                        <button onclick="publishPropertyCard(${sellerId})" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">📢 نشر في العقارات المتاحة</button>
                        <button onclick="sharePropertyCard()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">📤 مشاركة المقطف</button>
                        <button onclick="saveCardTemplate(${sellerId})" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-colors">💾 حفظ كقالب</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        // Copy property card WhatsApp link
        function copyPropertyCardWhatsApp() {
            const message = encodeURIComponent('مرحباً، أنا مهتم بالعقار المعروض للبيع على موقع المستقبل للتسويق العقاري');
            const whatsappLink = `https://wa.me/201031020887?text=${message}`;
            
            navigator.clipboard.writeText(whatsappLink).then(() => {
                showCustomAlert('تم النسخ', 'تم نسخ رابط الواتساب بنجاح!');
            });
        }

        function copyCompanyWhatsAppLink() {
            const message = encodeURIComponent('مرحباً، أنا مهتم بالعقارات المعروضة على موقع المستقبل للتسويق العقاري');
            const whatsappLink = `https://wa.me/201091020887?text=${message}`;
            
            navigator.clipboard.writeText(whatsappLink).then(() => {
                showCustomAlert('تم النسخ', 'تم نسخ رابط الواتساب بنجاح! يمكنك الآن لصقه في أي مكان');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = whatsappLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCustomAlert('تم النسخ', 'تم نسخ رابط الواتساب بنجاح! يمكنك الآن لصقه في أي مكان');
            });
        }

        // Update card preview function
        function updateCardPreview() {
            // Update title
            const title = document.getElementById('card-title').value;
            document.getElementById('preview-title').textContent = title;
            
            // Update location
            const location = document.getElementById('card-location').value;
            document.getElementById('preview-location').textContent = `📍 ${location}`;
            
            // Update contact
            const contact = document.getElementById('card-contact').value;
            document.getElementById('preview-contact').textContent = `📱 ${contact}`;
            
            // Update notes
            const notes = document.getElementById('card-notes').value;
            const notesPreview = document.getElementById('card-notes-preview');
            const notesText = document.getElementById('notes-text');
            
            if (notes.trim()) {
                notesText.textContent = notes;
                notesPreview.style.display = 'block';
            } else {
                notesPreview.style.display = 'none';
            }
            
            // Update special features badges
            const badgesContainer = document.getElementById('card-badges');
            let badges = '';
            
            if (document.getElementById('feature-urgent').checked) {
                badges += '<span class="inline-block bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-semibold mr-2 mb-2">🔥 عرض عاجل</span>';
            }
            if (document.getElementById('feature-exclusive').checked) {
                badges += '<span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold mr-2 mb-2">⭐ حصري</span>';
            }
            if (document.getElementById('feature-new').checked) {
                badges += '<span class="inline-block bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold mr-2 mb-2">🆕 جديد</span>';
            }
            if (document.getElementById('feature-reduced').checked) {
                badges += '<span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-semibold mr-2 mb-2">💸 سعر مخفض</span>';
            }
            
            badgesContainer.innerHTML = badges;
            
            // Update extra details
            const extraDetailsContainer = document.getElementById('extra-details');
            let extraDetails = '';
            
            const detail1 = document.getElementById('extra-detail-1').value;
            const detail2 = document.getElementById('extra-detail-2').value;
            const detail3 = document.getElementById('extra-detail-3').value;
            
            if (detail1.trim() || detail2.trim() || detail3.trim()) {
                extraDetails = '<div class="grid grid-cols-1 gap-2 text-sm">';
                if (detail1.trim()) extraDetails += `<div class="bg-white p-2 rounded border">• ${detail1}</div>`;
                if (detail2.trim()) extraDetails += `<div class="bg-white p-2 rounded border">• ${detail2}</div>`;
                if (detail3.trim()) extraDetails += `<div class="bg-white p-2 rounded border">• ${detail3}</div>`;
                extraDetails += '</div>';
            }
            
            extraDetailsContainer.innerHTML = extraDetails;
            
            // Update card style
            const cardStyle = document.getElementById('card-style').value;
            const cardPreview = document.getElementById('property-card-preview');
            
            // Reset classes
            cardPreview.className = 'p-6 rounded-xl border-2 border-gray-300';
            
            switch(cardStyle) {
                case 'classic':
                    cardPreview.className += ' bg-gradient-to-br from-blue-50 to-green-50';
                    break;
                case 'modern':
                    cardPreview.className += ' bg-gradient-to-br from-gray-50 to-blue-50';
                    break;
                case 'elegant':
                    cardPreview.className += ' bg-gradient-to-br from-purple-50 to-pink-50';
                    break;
            }
        }

        // Copy property card content
        function copyPropertyCard() {
            const cardContent = document.getElementById('property-card-preview').innerText;
            navigator.clipboard.writeText(cardContent).then(() => {
                showCustomAlert('تم النسخ', 'تم نسخ محتوى المقطف بنجاح!');
            });
        }

        // Save card template function
        function saveCardTemplate(sellerId) {
            const template = {
                id: Date.now(),
                sellerId: sellerId,
                title: document.getElementById('card-title').value,
                location: document.getElementById('card-location').value,
                notes: document.getElementById('card-notes').value,
                contact: document.getElementById('card-contact').value,
                features: {
                    urgent: document.getElementById('feature-urgent').checked,
                    exclusive: document.getElementById('feature-exclusive').checked,
                    new: document.getElementById('feature-new').checked,
                    reduced: document.getElementById('feature-reduced').checked
                },
                extraDetails: [
                    document.getElementById('extra-detail-1').value,
                    document.getElementById('extra-detail-2').value,
                    document.getElementById('extra-detail-3').value
                ].filter(detail => detail.trim() !== ''),
                style: document.getElementById('card-style').value,
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin ? currentAdmin.fullName : 'مجهول'
            };
            
            // Save to localStorage or a templates array
            let savedTemplates = JSON.parse(localStorage.getItem('propertyCardTemplates') || '[]');
            savedTemplates.push(template);
            localStorage.setItem('propertyCardTemplates', JSON.stringify(savedTemplates));
            
            showCustomAlert('تم الحفظ', 'تم حفظ قالب المقطف بنجاح! يمكنك استخدامه لاحقاً');
            addNotification('قالب جديد', `تم حفظ قالب مقطف جديد للعقار`, 'success');
        }

        // Publish property card
        function publishPropertyCard(sellerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            if (!seller) return;
            
            seller.published = true;
            seller.publishedAt = new Date().toLocaleString('ar-EG');
            
            updateListings();
            showCustomAlert('تم النشر', 'تم نشر العقار في قسم العقارات المتاحة بنجاح!');
            
            // Close modal
            document.querySelector('.fixed').remove();
        }

        // Share property card
        function sharePropertyCard() {
            if (navigator.share) {
                navigator.share({
                    title: 'عقار للبيع - سوق عقارك',
                    text: 'شاهد هذا العقار المميز للبيع',
                    url: window.location.href
                });
            } else {
                showCustomAlert('المشاركة', 'يمكنك نسخ المقطف ومشاركته يدوياً');
            }
        }

        // Enhanced form submission with images
        function collectPropertyImages() {
            const imageInput = document.getElementById('property-images');
            const images = [];
            
            if (imageInput && imageInput.files.length > 0) {
                Array.from(imageInput.files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        images.push({
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            data: e.target.result
                        });
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            return images;
        }

        // Commission Calculator Functions
        function calculateSellerCommission() {
            const price = parseFloat(document.getElementById('seller-property-price').value);
            const rate = parseFloat(document.getElementById('seller-commission-rate').value);
            
            if (!price || price <= 0) {
                showCustomAlert('خطأ', 'يرجى إدخال سعر العقار');
                return;
            }
            
            const commission = (price * rate) / 100;
            
            const resultDiv = document.getElementById('seller-commission-result');
            resultDiv.innerHTML = `
                <div class="text-center">
                    <h5 class="text-lg font-bold text-green-700 mb-2">نتيجة حساب عمولة البائع</h5>
                    <div class="space-y-2">
                        <p class="text-sm text-gray-600">سعر العقار: ${price.toLocaleString()} جنيه</p>
                        <p class="text-sm text-gray-600">نسبة العمولة: ${rate}%</p>
                        <p class="text-xl font-bold text-green-600">العمولة: ${commission.toLocaleString()} جنيه</p>
                    </div>
                </div>
            `;
            resultDiv.classList.remove('hidden');
            
            document.getElementById('total-seller-commission').textContent = commission.toLocaleString();
            updateTotalCommission();
        }

        function calculateBuyerCommission() {
            const price = parseFloat(document.getElementById('buyer-property-price').value);
            const rate = parseFloat(document.getElementById('buyer-commission-rate').value);
            
            if (!price || price <= 0) {
                showCustomAlert('خطأ', 'يرجى إدخال سعر العقار');
                return;
            }
            
            const commission = (price * rate) / 100;
            
            const resultDiv = document.getElementById('buyer-commission-result');
            resultDiv.innerHTML = `
                <div class="text-center">
                    <h5 class="text-lg font-bold text-blue-700 mb-2">نتيجة حساب عمولة المشتري</h5>
                    <div class="space-y-2">
                        <p class="text-sm text-gray-600">سعر العقار: ${price.toLocaleString()} جنيه</p>
                        <p class="text-sm text-gray-600">نسبة العمولة: ${rate}%</p>
                        <p class="text-xl font-bold text-blue-600">العمولة: ${commission.toLocaleString()} جنيه</p>
                    </div>
                </div>
            `;
            resultDiv.classList.remove('hidden');
            
            document.getElementById('total-buyer-commission').textContent = commission.toLocaleString();
            updateTotalCommission();
        }

        function updateTotalCommission() {
            const sellerCommission = parseFloat(document.getElementById('total-seller-commission').textContent.replace(/,/g, '')) || 0;
            const buyerCommission = parseFloat(document.getElementById('total-buyer-commission').textContent.replace(/,/g, '')) || 0;
            const total = sellerCommission + buyerCommission;
            
            document.getElementById('total-commission').textContent = total.toLocaleString();
        }

        // Inquiries Management Functions
        function showInquiryForm() {
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-indigo-700">📞 إضافة استعلام جديد</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <form onsubmit="addInquiry(event)">
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">اسم العميل</label>
                                <input type="text" id="inquiry-client-name" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                                <input type="tel" id="inquiry-whatsapp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نوع الاستعلام</label>
                                <select id="inquiry-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" required>
                                    <option value="">اختر نوع الاستعلام</option>
                                    <option value="property-inquiry">استعلام عن عقار</option>
                                    <option value="viewing-request">طلب معاينة</option>
                                    <option value="price-negotiation">تفاوض على السعر</option>
                                    <option value="general-inquiry">استعلام عام</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الأولوية</label>
                                <select id="inquiry-priority" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" required>
                                    <option value="normal">عادية</option>
                                    <option value="high">عالية</option>
                                    <option value="urgent">عاجلة</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">تفاصيل الاستعلام</label>
                            <textarea id="inquiry-details" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none h-24" placeholder="اكتب تفاصيل الاستعلام..." required></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">موعد المتابعة (اختياري)</label>
                            <input type="datetime-local" id="inquiry-follow-date" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">إضافة الاستعلام</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function addInquiry(event) {
            event.preventDefault();
            
            const inquiry = {
                id: Date.now(),
                clientName: document.getElementById('inquiry-client-name').value,
                whatsapp: document.getElementById('inquiry-whatsapp').value,
                type: document.getElementById('inquiry-type').value,
                priority: document.getElementById('inquiry-priority').value,
                details: document.getElementById('inquiry-details').value,
                followDate: document.getElementById('inquiry-follow-date').value,
                status: 'pending',
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName
            };
            
            inquiries.push(inquiry);
            updateInquiriesList();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            // Add notification
            addNotification('استعلام جديد', `تم إضافة استعلام جديد من ${inquiry.clientName}`, 'info');
            
            // Set reminder if follow date is set
            if (inquiry.followDate) {
                setInquiryReminder(inquiry);
            }
            
            showCustomAlert('تم بنجاح', 'تم إضافة الاستعلام بنجاح');
        }

        function updateInquiriesList() {
            const inquiriesList = document.getElementById('inquiries-list');
            
            inquiriesList.innerHTML = inquiries.length > 0 ? inquiries.map(inquiry => `
                <div class="bg-white p-4 rounded-lg border-2 ${getPriorityBorderColor(inquiry.priority)} hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h5 class="font-bold text-gray-800">${inquiry.clientName}</h5>
                            <p class="text-sm text-gray-600">${getInquiryTypeArabic(inquiry.type)}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${getPriorityBadgeClass(inquiry.priority)}">${getPriorityArabic(inquiry.priority)}</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${getStatusBadgeClass(inquiry.status)}">${getStatusArabic(inquiry.status)}</span>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-2">📱 ${inquiry.whatsapp}</p>
                    <p class="text-sm text-gray-600 mb-2">${inquiry.details}</p>
                    ${inquiry.followDate ? `<p class="text-sm text-blue-600 mb-2">📅 متابعة: ${new Date(inquiry.followDate).toLocaleString('ar-EG')}</p>` : ''}
                    <p class="text-xs text-gray-500 mb-3">تم الإنشاء: ${inquiry.createdAt} بواسطة ${inquiry.createdBy}</p>
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="updateInquiryStatus(${inquiry.id}, 'contacted')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">تم التواصل</button>
                        <button onclick="updateInquiryStatus(${inquiry.id}, 'scheduled')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">تحديد موعد</button>
                        <button onclick="copyWhatsAppLink('${inquiry.whatsapp}', 'inquiry')" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">واتساب</button>
                        <button onclick="editInquiry(${inquiry.id})" class="text-xs bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition-colors">تعديل</button>
                        <button onclick="deleteInquiry(${inquiry.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">حذف</button>
                    </div>
                </div>
            `).join('') : `
                <div class="text-center text-gray-500 py-8">
                    <div class="text-4xl mb-4">📞</div>
                    <p>لا توجد استعلامات حتى الآن. اضغط "إضافة استعلام" لبدء المتابعة</p>
                </div>
            `;
            
            // Update counters
            updateInquiryCounters();
        }

        function updateInquiryCounters() {
            const pending = inquiries.filter(i => i.status === 'pending').length;
            const contacted = inquiries.filter(i => i.status === 'contacted').length;
            const scheduled = inquiries.filter(i => i.status === 'scheduled').length;
            
            document.getElementById('pending-inquiries').textContent = pending;
            document.getElementById('contacted-inquiries').textContent = contacted;
            document.getElementById('scheduled-inquiries').textContent = scheduled;
        }

        function filterInquiries(status) {
            const filtered = inquiries.filter(i => i.status === status);
            const inquiriesList = document.getElementById('inquiries-list');
            
            inquiriesList.innerHTML = filtered.length > 0 ? filtered.map(inquiry => `
                <div class="bg-white p-4 rounded-lg border-2 ${getPriorityBorderColor(inquiry.priority)} hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h5 class="font-bold text-gray-800">${inquiry.clientName}</h5>
                            <p class="text-sm text-gray-600">${getInquiryTypeArabic(inquiry.type)}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${getPriorityBadgeClass(inquiry.priority)}">${getPriorityArabic(inquiry.priority)}</span>
                            <span class="px-2 py-1 rounded-full text-xs font-semibold ${getStatusBadgeClass(inquiry.status)}">${getStatusArabic(inquiry.status)}</span>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-2">📱 ${inquiry.whatsapp}</p>
                    <p class="text-sm text-gray-600 mb-2">${inquiry.details}</p>
                    ${inquiry.followDate ? `<p class="text-sm text-blue-600 mb-2">📅 متابعة: ${new Date(inquiry.followDate).toLocaleString('ar-EG')}</p>` : ''}
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="updateInquiryStatus(${inquiry.id}, 'contacted')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">تم التواصل</button>
                        <button onclick="copyWhatsAppLink('${inquiry.whatsapp}', 'inquiry')" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">واتساب</button>
                    </div>
                </div>
            `).join('') : `<p class="text-center text-gray-500 py-8">لا توجد استعلامات بحالة "${getStatusArabic(status)}"</p>`;
        }

        function updateInquiryStatus(inquiryId, newStatus) {
            const inquiry = inquiries.find(i => i.id === inquiryId);
            if (inquiry) {
                inquiry.status = newStatus;
                inquiry.lastUpdated = new Date().toLocaleString('ar-EG');
                updateInquiriesList();
                showCustomAlert('تم التحديث', `تم تحديث حالة الاستعلام إلى "${getStatusArabic(newStatus)}"`);
            }
        }

        function createInquiry(sellerId, buyerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            const buyer = buyerRegistrations.find(b => b.id === buyerId);
            
            if (!seller || !buyer) return;
            
            const inquiry = {
                id: Date.now(),
                clientName: `${seller.name} & ${buyer.name}`,
                whatsapp: `${seller.whatsapp} / ${buyer.whatsapp}`,
                type: 'property-matching',
                priority: 'high',
                details: `توفيق بين بائع ${getPropertyTypeArabic(seller.propertyType)} (${seller.name}) ومشتري (${buyer.name}) في ${getLocationArabic(seller.location)}`,
                status: 'pending',
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName,
                sellerId: sellerId,
                buyerId: buyerId
            };
            
            inquiries.push(inquiry);
            updateInquiriesList();
            
            addNotification('استعلام توفيق جديد', `تم إنشاء استعلام توفيق بين ${seller.name} و ${buyer.name}`, 'success');
            showCustomAlert('تم بنجاح', 'تم إنشاء استعلام التوفيق بنجاح');
        }

        function scheduleViewing(sellerId, buyerId) {
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            const buyer = buyerRegistrations.find(b => b.id === buyerId);
            
            if (!seller || !buyer) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-purple-700 mb-4">📅 تحديد موعد معاينة</h3>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2"><strong>البائع:</strong> ${seller.name} (${seller.whatsapp})</p>
                        <p class="text-sm text-gray-600 mb-2"><strong>المشتري:</strong> ${buyer.name} (${buyer.whatsapp})</p>
                        <p class="text-sm text-gray-600 mb-4"><strong>العقار:</strong> ${getPropertyTypeArabic(seller.propertyType)} في ${getLocationArabic(seller.location)}</p>
                    </div>
                    
                    <form onsubmit="confirmViewing(event, ${sellerId}, ${buyerId})">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">موعد المعاينة</label>
                            <input type="datetime-local" id="viewing-date" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ملاحظات</label>
                            <textarea id="viewing-notes" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none h-20" placeholder="ملاحظات إضافية..."></textarea>
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">تأكيد الموعد</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function confirmViewing(event, sellerId, buyerId) {
            event.preventDefault();
            
            const seller = sellerRegistrations.find(s => s.id === sellerId);
            const buyer = buyerRegistrations.find(b => b.id === buyerId);
            const viewingDate = document.getElementById('viewing-date').value;
            const notes = document.getElementById('viewing-notes').value;
            
            const inquiry = {
                id: Date.now(),
                clientName: `معاينة: ${seller.name} & ${buyer.name}`,
                whatsapp: `${seller.whatsapp} / ${buyer.whatsapp}`,
                type: 'viewing-request',
                priority: 'high',
                details: `موعد معاينة ${getPropertyTypeArabic(seller.propertyType)} في ${getLocationArabic(seller.location)}. ${notes ? 'ملاحظات: ' + notes : ''}`,
                followDate: viewingDate,
                status: 'scheduled',
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName,
                sellerId: sellerId,
                buyerId: buyerId
            };
            
            inquiries.push(inquiry);
            updateInquiriesList();
            
            // Set reminder
            setInquiryReminder(inquiry);
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            addNotification('موعد معاينة جديد', `تم تحديد موعد معاينة في ${new Date(viewingDate).toLocaleString('ar-EG')}`, 'info');
            showCustomAlert('تم بنجاح', 'تم تحديد موعد المعاينة بنجاح');
        }

        function setInquiryReminder(inquiry) {
            if (!inquiry.followDate) return;
            
            const reminderTime = new Date(inquiry.followDate).getTime() - Date.now();
            
            if (reminderTime > 0) {
                setTimeout(() => {
                    addNotification('تذكير موعد', `حان موعد متابعة الاستعلام مع ${inquiry.clientName}`, 'reminder');
                }, reminderTime);
            }
        }

        // Legacy service request function (for backward compatibility)
        function requestService(serviceType) {
            // Find service by old type mapping
            const typeMapping = {
                'apartment-design': 1,
                'shop-design': 2,
                'turnkey': 3
            };
            
            const serviceId = typeMapping[serviceType];
            if (serviceId) {
                requestServiceFromHome(serviceId);
            }
        }

        function updateServiceRequests() {
            const container = document.getElementById('service-requests');
            
            container.innerHTML = serviceRequests.length > 0 ? serviceRequests.map(request => `
                <div class="bg-white p-4 rounded-lg border border-orange-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-2">
                        <h5 class="font-bold text-orange-700">${request.serviceTitle}</h5>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                            ${request.status === 'pending' ? 'قيد المراجعة' : 'تم التواصل'}
                        </span>
                    </div>
                    <div class="mb-3">
                        <p class="text-sm text-gray-600 mb-1">👤 <strong>العميل:</strong> ${request.clientName}</p>
                        <p class="text-sm text-gray-600 mb-1">📱 <strong>الواتساب:</strong> ${request.whatsapp}</p>
                        <p class="text-sm text-gray-600 mb-1">📅 <strong>تاريخ الطلب:</strong> ${request.createdAt}</p>
                    </div>
                    <div class="mb-3 p-3 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-700"><strong>تفاصيل المشروع:</strong></p>
                        <p class="text-sm text-gray-600 mt-1">${request.details}</p>
                    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="copyWhatsAppLink('${request.whatsapp}', 'service')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">📱 واتساب</button>
                        ${request.status === 'pending' ? `<button onclick="updateServiceRequestStatus(${request.id}, 'contacted')" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">✅ تم التواصل</button>` : ''}
                        <button onclick="viewServiceRequestDetails(${request.id})" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">👁️ التفاصيل</button>
                        <button onclick="deleteServiceRequest(${request.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">🗑️ حذف</button>
                    </div>
                </div>
            `).join('') : `
                <div class="text-center text-gray-500 py-8">
                    <div class="text-4xl mb-4">🏗️</div>
                    <p>لا توجد طلبات خدمات حتى الآن</p>
                </div>
            `;
        }

        function updateServiceRequestStatus(requestId, newStatus) {
            const request = serviceRequests.find(r => r.id === requestId);
            if (request) {
                request.status = newStatus;
                request.updatedAt = new Date().toLocaleString('ar-EG');
                updateServiceRequests();
                showCustomAlert('تم التحديث', 'تم تحديث حالة طلب الخدمة بنجاح');
            }
        }

        function viewServiceRequestDetails(requestId) {
            const request = serviceRequests.find(r => r.id === requestId);
            if (!request) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-orange-700">تفاصيل طلب الخدمة</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <h4 class="font-bold text-orange-700 mb-2">معلومات الخدمة</h4>
                            <p class="text-gray-700"><strong>نوع الخدمة:</strong> ${request.serviceTitle}</p>
                            <p class="text-gray-700"><strong>الحالة:</strong> 
                                <span class="px-2 py-1 rounded-full text-xs font-semibold ${request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800'}">
                                    ${request.status === 'pending' ? 'قيد المراجعة' : 'تم التواصل'}
                                </span>
                            </p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-700 mb-2">معلومات العميل</h4>
                            <p class="text-gray-700"><strong>الاسم:</strong> ${request.clientName}</p>
                            <p class="text-gray-700"><strong>رقم الواتساب:</strong> ${request.whatsapp}</p>
                            <p class="text-gray-700"><strong>تاريخ الطلب:</strong> ${request.createdAt}</p>
                            ${request.updatedAt ? `<p class="text-gray-700"><strong>آخر تحديث:</strong> ${request.updatedAt}</p>` : ''}
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-bold text-gray-700 mb-2">تفاصيل المشروع</h4>
                            <p class="text-gray-700 whitespace-pre-wrap">${request.details}</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 justify-center mt-6">
                        <button onclick="copyWhatsAppLink('${request.whatsapp}', 'service')" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">تواصل عبر واتساب</button>
                        ${request.status === 'pending' ? `<button onclick="updateServiceRequestStatus(${request.id}, 'contacted'); this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">تم التواصل</button>` : ''}
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إغلاق</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function deleteServiceRequest(requestId) {
            const request = serviceRequests.find(r => r.id === requestId);
            if (!request) return;
            
            showCustomConfirm('حذف طلب الخدمة', `هل أنت متأكد من حذف طلب الخدمة من "${request.clientName}"؟`, () => {
                serviceRequests = serviceRequests.filter(r => r.id !== requestId);
                updateServiceRequests();
                showCustomAlert('تم الحذف', 'تم حذف طلب الخدمة بنجاح');
            });
        }

        // Helper functions for Arabic translations
        function getInquiryTypeArabic(type) {
            const types = {
                'property-inquiry': 'استعلام عن عقار',
                'viewing-request': 'طلب معاينة',
                'price-negotiation': 'تفاوض على السعر',
                'general-inquiry': 'استعلام عام',
                'property-matching': 'توفيق عقاري'
            };
            return types[type] || type;
        }

        function getPriorityArabic(priority) {
            const priorities = {
                'normal': 'عادية',
                'high': 'عالية',
                'urgent': 'عاجلة'
            };
            return priorities[priority] || priority;
        }

        function getStatusArabic(status) {
            const statuses = {
                'pending': 'قيد المتابعة',
                'contacted': 'تم التواصل',
                'scheduled': 'موعد محدد',
                'completed': 'مكتمل'
            };
            return statuses[status] || status;
        }

        function getPriorityBorderColor(priority) {
            const colors = {
                'normal': 'border-gray-300',
                'high': 'border-yellow-400',
                'urgent': 'border-red-400'
            };
            return colors[priority] || 'border-gray-300';
        }

        function getPriorityBadgeClass(priority) {
            const classes = {
                'normal': 'bg-gray-100 text-gray-800',
                'high': 'bg-yellow-100 text-yellow-800',
                'urgent': 'bg-red-100 text-red-800'
            };
            return classes[priority] || 'bg-gray-100 text-gray-800';
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'contacted': 'bg-green-100 text-green-800',
                'scheduled': 'bg-blue-100 text-blue-800',
                'completed': 'bg-purple-100 text-purple-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        function getServiceTypeArabic(type) {
            const types = {
                'apartment-design': 'تصميم شقة',
                'shop-design': 'تصميم محل',
                'turnkey': 'استلام على المفتاح'
            };
            return types[type] || type;
        }

        // Services Management Functions
        function showAddServiceForm() {
            document.getElementById('add-service-form').classList.remove('hidden');
        }

        function hideAddServiceForm() {
            document.getElementById('add-service-form').classList.add('hidden');
            document.querySelector('#add-service-form form').reset();
        }

        function addNewService(event) {
            event.preventDefault();
            
            const title = document.getElementById('new-service-title').value;
            const category = document.getElementById('new-service-category').value;
            const icon = document.getElementById('new-service-icon').value;
            const price = document.getElementById('new-service-price').value;
            const description = document.getElementById('new-service-description').value;
            const featuresText = document.getElementById('new-service-features').value;
            const active = document.getElementById('new-service-active').checked;
            
            const features = featuresText.split('\n').filter(f => f.trim() !== '');
            
            const newService = {
                id: Date.now(),
                title: title,
                description: description,
                features: features,
                price: price,
                category: category,
                icon: icon,
                active: active,
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName
            };
            
            contractingServices.push(newService);
            updateServicesList();
            updateHomeServices();
            hideAddServiceForm();
            
            showCustomAlert('تم بنجاح', `تم إضافة الخدمة "${title}" بنجاح`);
            addNotification('خدمة جديدة', `تم إضافة خدمة جديدة: ${title}`, 'success');
        }

        function updateServicesList() {
            const servicesList = document.getElementById('services-list');
            
            servicesList.innerHTML = contractingServices.map(service => `
                <div class="bg-orange-50 border border-orange-200 rounded-lg p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <div class="text-3xl">${service.icon}</div>
                            <div>
                                <h4 class="font-bold text-orange-700 text-lg">${service.title}</h4>
                                <p class="text-sm text-gray-600">الفئة: ${service.category}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${service.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${service.active ? 'نشطة' : 'غير نشطة'}
                            </span>
                        </div>
                    </div>
                    
                    <p class="text-gray-600 mb-3">${service.description}</p>
                    
                    <div class="mb-3">
                        <h5 class="font-semibold text-gray-700 mb-2">المميزات:</h5>
                        <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                            ${service.features.map(feature => `<li>${feature}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-lg font-bold text-orange-600">💰 ${service.price}</p>
                    </div>
                    
                    <div class="text-xs text-gray-500 mb-4">
                        <p>تم الإنشاء: ${service.createdAt}</p>
                        ${service.createdBy ? `<p>بواسطة: ${service.createdBy}</p>` : ''}
                    </div>
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="toggleServiceStatus(${service.id})" class="text-xs ${service.active ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'} text-white px-3 py-1 rounded transition-colors">
                            ${service.active ? 'إلغاء التفعيل' : 'تفعيل'}
                        </button>
                        <button onclick="editService(${service.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">تعديل</button>
                        <button onclick="duplicateService(${service.id})" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">نسخ</button>
                        <button onclick="deleteService(${service.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">حذف</button>
                        <button onclick="viewServiceDetails(${service.id})" class="text-xs bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition-colors">عرض التفاصيل</button>
                    </div>
                </div>
            `).join('') || '<p class="text-center text-gray-500 py-8">لا توجد خدمات مضافة حتى الآن</p>';
        }

        function updateHomeServices() {
            const homeServicesGrid = document.getElementById('home-services-grid');
            const activeServices = contractingServices.filter(service => service.active);
            
            if (activeServices.length === 0) {
                document.getElementById('contracting-services-section').style.display = 'none';
                return;
            }
            
            document.getElementById('contracting-services-section').style.display = 'block';
            
            homeServicesGrid.innerHTML = activeServices.map(service => `
                <div class="property-card bg-white rounded-2xl shadow-xl p-6 border-t-4 border-orange-500">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-3">${service.icon}</div>
                        <h4 class="text-xl font-bold text-orange-700 mb-2">${service.title}</h4>
                        <p class="text-gray-600 text-sm mb-3">${service.description}</p>
                        <div class="text-sm text-gray-600 mb-4">للاستعلام عن الأسعار تواصل معنا</div>
                    </div>
                    <button onclick="requestServiceFromHome(${service.id})" class="w-full bg-orange-600 text-white py-3 rounded-xl text-lg font-semibold hover:bg-orange-700 transition-colors">
                        طلب الخدمة
                    </button>
                </div>
            `).join('');
        }

        function toggleServiceStatus(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (service) {
                service.active = !service.active;
                updateServicesList();
                updateHomeServices();
                
                const status = service.active ? 'تم تفعيل' : 'تم إلغاء تفعيل';
                showCustomAlert('تم التحديث', `${status} الخدمة "${service.title}"`);
            }
        }

        function editService(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (!service) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-orange-700">تعديل الخدمة</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <form onsubmit="updateService(event, ${serviceId})">
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">عنوان الخدمة</label>
                                <input type="text" id="edit-service-title" value="${service.title}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الفئة</label>
                                <select id="edit-service-category" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                    <option value="تصميم" ${service.category === 'تصميم' ? 'selected' : ''}>تصميم</option>
                                    <option value="مقاولات" ${service.category === 'مقاولات' ? 'selected' : ''}>مقاولات</option>
                                    <option value="تشطيبات" ${service.category === 'تشطيبات' ? 'selected' : ''}>تشطيبات</option>
                                    <option value="صيانة" ${service.category === 'صيانة' ? 'selected' : ''}>صيانة</option>
                                    <option value="استشارات" ${service.category === 'استشارات' ? 'selected' : ''}>استشارات</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">الأيقونة</label>
                                <select id="edit-service-icon" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                    <option value="🏠" ${service.icon === '🏠' ? 'selected' : ''}>🏠 شقة</option>
                                    <option value="🏪" ${service.icon === '🏪' ? 'selected' : ''}>🏪 محل</option>
                                    <option value="🏢" ${service.icon === '🏢' ? 'selected' : ''}>🏢 مكتب</option>
                                    <option value="🏗️" ${service.icon === '🏗️' ? 'selected' : ''}>🏗️ بناء</option>
                                    <option value="🔑" ${service.icon === '🔑' ? 'selected' : ''}>🔑 مفتاح</option>
                                    <option value="🎨" ${service.icon === '🎨' ? 'selected' : ''}>🎨 تصميم</option>
                                    <option value="🔧" ${service.icon === '🔧' ? 'selected' : ''}>🔧 صيانة</option>
                                    <option value="📐" ${service.icon === '📐' ? 'selected' : ''}>📐 هندسة</option>
                                    <option value="💡" ${service.icon === '💡' ? 'selected' : ''}>💡 إضاءة</option>
                                    <option value="🪟" ${service.icon === '🪟' ? 'selected' : ''}>🪟 نوافذ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">السعر</label>
                                <input type="text" id="edit-service-price" value="${service.price}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">وصف الخدمة</label>
                            <textarea id="edit-service-description" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-24" required>${service.description}</textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">المميزات (كل ميزة في سطر منفصل)</label>
                            <textarea id="edit-service-features" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-24" required>${service.features.join('\n')}</textarea>
                        </div>
                        <div class="mb-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="edit-service-active" class="mr-2 w-5 h-5" ${service.active ? 'checked' : ''}>
                                <span class="font-semibold text-gray-700">خدمة نشطة</span>
                            </label>
                        </div>
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors">حفظ التعديلات</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function updateService(event, serviceId) {
            event.preventDefault();
            
            const serviceIndex = contractingServices.findIndex(s => s.id === serviceId);
            if (serviceIndex === -1) return;
            
            const title = document.getElementById('edit-service-title').value;
            const category = document.getElementById('edit-service-category').value;
            const icon = document.getElementById('edit-service-icon').value;
            const price = document.getElementById('edit-service-price').value;
            const description = document.getElementById('edit-service-description').value;
            const featuresText = document.getElementById('edit-service-features').value;
            const active = document.getElementById('edit-service-active').checked;
            
            const features = featuresText.split('\n').filter(f => f.trim() !== '');
            
            contractingServices[serviceIndex] = {
                ...contractingServices[serviceIndex],
                title: title,
                description: description,
                features: features,
                price: price,
                category: category,
                icon: icon,
                active: active,
                updatedAt: new Date().toLocaleString('ar-EG'),
                updatedBy: currentAdmin.fullName
            };
            
            updateServicesList();
            updateHomeServices();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم التحديث', `تم تحديث الخدمة "${title}" بنجاح`);
        }

        function duplicateService(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (!service) return;
            
            const duplicatedService = {
                ...service,
                id: Date.now(),
                title: service.title + ' (نسخة)',
                active: false,
                createdAt: new Date().toLocaleString('ar-EG'),
                createdBy: currentAdmin.fullName
            };
            
            contractingServices.push(duplicatedService);
            updateServicesList();
            
            showCustomAlert('تم النسخ', `تم نسخ الخدمة "${service.title}" بنجاح`);
        }

        function deleteService(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (!service) return;
            
            showCustomConfirm('حذف الخدمة', `هل أنت متأكد من حذف الخدمة "${service.title}"؟`, () => {
                contractingServices = contractingServices.filter(s => s.id !== serviceId);
                updateServicesList();
                updateHomeServices();
                showCustomAlert('تم الحذف', 'تم حذف الخدمة بنجاح');
            });
        }

        function viewServiceDetails(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (!service) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-orange-700">تفاصيل الخدمة</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">${service.icon}</div>
                        <h4 class="text-2xl font-bold text-orange-700 mb-2">${service.title}</h4>
                        <p class="text-gray-600 mb-2">الفئة: ${service.category}</p>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${service.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${service.active ? 'خدمة نشطة' : 'خدمة غير نشطة'}
                        </span>
                    </div>
                    
                    <div class="mb-6">
                        <h5 class="font-bold text-gray-700 mb-2">وصف الخدمة:</h5>
                        <p class="text-gray-600 mb-4">${service.description}</p>
                        
                        <h5 class="font-bold text-gray-700 mb-2">المميزات المتضمنة:</h5>
                        <ul class="list-disc list-inside space-y-1 mb-4">
                            ${service.features.map(feature => `<li class="text-gray-600">${feature}</li>`).join('')}
                        </ul>
                        
                        <div class="bg-orange-50 p-4 rounded-lg mb-4">
                            <p class="text-lg font-bold text-orange-700">💰 السعر: ${service.price}</p>
                        </div>
                        
                        <div class="text-xs text-gray-500">
                            <p>تم الإنشاء: ${service.createdAt}</p>
                            ${service.createdBy ? `<p>بواسطة: ${service.createdBy}</p>` : ''}
                            ${service.updatedAt ? `<p>آخر تحديث: ${service.updatedAt}</p>` : ''}
                            ${service.updatedBy ? `<p>تم التحديث بواسطة: ${service.updatedBy}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="flex gap-4 justify-center">
                        <button onclick="editService(${service.id}); this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">تعديل الخدمة</button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إغلاق</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function requestServiceFromHome(serviceId) {
            const service = contractingServices.find(s => s.id === serviceId);
            if (!service) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <div class="text-center mb-4">
                        <div class="text-4xl mb-2">${service.icon}</div>
                        <h3 class="text-xl font-bold text-orange-700">${service.title}</h3>
                        <p class="text-gray-600 text-sm">${service.description}</p>
                    </div>
                    
                    <form onsubmit="submitServiceRequest(event, ${serviceId})">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">اسم العميل</label>
                            <input type="text" id="service-client-name" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                            <input type="tel" id="service-whatsapp" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">تفاصيل المشروع</label>
                            <textarea id="service-details" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-24" placeholder="اكتب تفاصيل المشروع..." required></textarea>
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">إرسال الطلب</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function submitServiceRequest(event, serviceId) {
            event.preventDefault();
            
            const service = contractingServices.find(s => s.id === serviceId);
            const clientName = document.getElementById('service-client-name').value;
            const whatsapp = document.getElementById('service-whatsapp').value;
            const details = document.getElementById('service-details').value;
            
            // Add to service requests
            const request = {
                id: Date.now(),
                serviceId: serviceId,
                serviceTitle: service ? service.title : 'خدمة محذوفة',
                clientName: clientName,
                whatsapp: whatsapp,
                details: details,
                status: 'pending',
                createdAt: new Date().toLocaleString('ar-EG')
            };
            
            serviceRequests.push(request);
            
            // Add to contracting clients
            const contractingClient = {
                id: Date.now() + 1, // Different ID
                serviceId: serviceId,
                serviceTitle: service ? service.title : 'خدمة محذوفة',
                serviceCategory: service ? service.category : 'غير محدد',
                clientName: clientName,
                whatsapp: whatsapp,
                projectDetails: details,
                status: 'pending',
                createdAt: new Date().toLocaleString('ar-EG'),
                source: 'website'
            };
            
            contractingClients.push(contractingClient);
            
            updateServiceRequests();
            updateContractingClients();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            addNotification('عميل مقاولات جديد', `عميل جديد: ${clientName} للخدمة: ${request.serviceTitle}`, 'info');
            showCustomAlert('تم بنجاح', 'تم إرسال طلب الخدمة بنجاح! سيتم التواصل معك قريباً');
        }

        // Contracting Clients Management Functions
        function updateContractingClients() {
            const clientsList = document.getElementById('contracting-clients-list');
            const clientsCount = document.getElementById('contracting-clients-count');
            
            // Update count
            clientsCount.textContent = `${contractingClients.length} عميل`;
            
            // Update service filter options
            updateServiceFilterOptions();
            
            clientsList.innerHTML = contractingClients.length > 0 ? contractingClients.map(client => `
                <div class="bg-white p-6 rounded-lg border border-orange-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-orange-700 text-lg">${client.clientName}</h4>
                            <p class="text-sm text-gray-600">📱 ${client.whatsapp}</p>
                            <p class="text-sm text-gray-600">🏗️ ${client.serviceTitle}</p>
                            <p class="text-sm text-gray-600">📂 ${client.serviceCategory}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${getContractingStatusBadgeClass(client.status)}">
                                ${getContractingStatusArabic(client.status)}
                            </span>
                            <span class="px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">${client.source === 'website' ? 'موقع' : 'يدوي'}</span>
                        </div>
                    </div>
                    
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">تفاصيل المشروع:</h5>
                        <p class="text-sm text-gray-600">${client.projectDetails}</p>
                    </div>
                    
                    <div class="mb-4 text-xs text-gray-500">
                        <p>تاريخ التسجيل: ${client.createdAt}</p>
                        ${client.lastContact ? `<p>آخر تواصل: ${client.lastContact}</p>` : ''}
                        ${client.notes ? `<p>ملاحظات: ${client.notes}</p>` : ''}
                    </div>
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="copyWhatsAppLink('${client.whatsapp}', 'contracting')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">📱 واتساب</button>
                        <button onclick="updateContractingClientStatus(${client.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">📝 تحديث الحالة</button>
                        <button onclick="addClientNotes(${client.id})" class="text-xs bg-purple-500 text-white px-3 py-1 rounded hover:bg-purple-600 transition-colors">📋 إضافة ملاحظات</button>
                        <button onclick="viewContractingClientDetails(${client.id})" class="text-xs bg-indigo-500 text-white px-3 py-1 rounded hover:bg-indigo-600 transition-colors">👁️ التفاصيل</button>
                        <button onclick="editContractingClient(${client.id})" class="text-xs bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition-colors">✏️ تعديل</button>
                        <button onclick="deleteContractingClient(${client.id})" class="text-xs bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors">🗑️ حذف</button>
                    </div>
                </div>
            `).join('') : `
                <div class="text-center text-gray-500 py-8">
                    <div class="text-4xl mb-4">👷</div>
                    <p>لا توجد عملاء مقاولات حتى الآن</p>
                </div>
            `;
        }

        function updateServiceFilterOptions() {
            const serviceFilter = document.getElementById('contracting-service-filter');
            const uniqueServices = [...new Set(contractingClients.map(c => c.serviceTitle))];
            
            serviceFilter.innerHTML = '<option value="">جميع الخدمات</option>' + 
                uniqueServices.map(service => `<option value="${service}">${service}</option>`).join('');
        }

        function filterContractingClients() {
            const searchTerm = document.getElementById('contracting-search').value.toLowerCase();
            const serviceFilter = document.getElementById('contracting-service-filter').value;
            const statusFilter = document.getElementById('contracting-status-filter').value;
            
            let filteredClients = contractingClients;
            
            if (searchTerm) {
                filteredClients = filteredClients.filter(client => 
                    client.clientName.toLowerCase().includes(searchTerm) ||
                    client.whatsapp.includes(searchTerm)
                );
            }
            
            if (serviceFilter) {
                filteredClients = filteredClients.filter(client => client.serviceTitle === serviceFilter);
            }
            
            if (statusFilter) {
                filteredClients = filteredClients.filter(client => client.status === statusFilter);
            }
            
            displayFilteredContractingClients(filteredClients);
        }

        function displayFilteredContractingClients(clients) {
            const clientsList = document.getElementById('contracting-clients-list');
            
            clientsList.innerHTML = clients.length > 0 ? clients.map(client => `
                <div class="bg-white p-6 rounded-lg border border-orange-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-orange-700 text-lg">${client.clientName}</h4>
                            <p class="text-sm text-gray-600">📱 ${client.whatsapp}</p>
                            <p class="text-sm text-gray-600">🏗️ ${client.serviceTitle}</p>
                            <p class="text-sm text-gray-600">📂 ${client.serviceCategory}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${getContractingStatusBadgeClass(client.status)}">
                                ${getContractingStatusArabic(client.status)}
                            </span>
                        </div>
                    </div>
                    
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">تفاصيل المشروع:</h5>
                        <p class="text-sm text-gray-600">${client.projectDetails}</p>
                    </div>
                    
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="copyWhatsAppLink('${client.whatsapp}', 'contracting')" class="text-xs bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">📱 واتساب</button>
                        <button onclick="updateContractingClientStatus(${client.id})" class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">📝 تحديث الحالة</button>
                        <button onclick="viewContractingClientDetails(${client.id})" class="text-xs bg-indigo-500 text-white px-3 py-1 rounded hover:bg-indigo-600 transition-colors">👁️ التفاصيل</button>
                    </div>
                </div>
            `).join('') : `
                <div class="text-center text-gray-500 py-8">
                    <div class="text-4xl mb-4">🔍</div>
                    <p>لا توجد نتائج مطابقة للبحث</p>
                </div>
            `;
        }

        function updateContractingClientStatus(clientId) {
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-orange-700 mb-4">تحديث حالة العميل</h3>
                    
                    <div class="mb-4">
                        <p class="text-gray-700 mb-2"><strong>العميل:</strong> ${client.clientName}</p>
                        <p class="text-gray-700 mb-4"><strong>الخدمة:</strong> ${client.serviceTitle}</p>
                    </div>
                    
                    <form onsubmit="saveContractingClientStatus(event, ${clientId})">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">الحالة الجديدة</label>
                            <select id="new-client-status" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none" required>
                                <option value="pending" ${client.status === 'pending' ? 'selected' : ''}>قيد المراجعة</option>
                                <option value="contacted" ${client.status === 'contacted' ? 'selected' : ''}>تم التواصل</option>
                                <option value="in-progress" ${client.status === 'in-progress' ? 'selected' : ''}>قيد التنفيذ</option>
                                <option value="completed" ${client.status === 'completed' ? 'selected' : ''}>مكتمل</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ملاحظات التحديث</label>
                            <textarea id="status-notes" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:outline-none h-20" placeholder="اكتب ملاحظات حول التحديث..."></textarea>
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">حفظ التحديث</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function saveContractingClientStatus(event, clientId) {
            event.preventDefault();
            
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const newStatus = document.getElementById('new-client-status').value;
            const notes = document.getElementById('status-notes').value;
            
            client.status = newStatus;
            client.lastContact = new Date().toLocaleString('ar-EG');
            
            if (notes) {
                client.notes = (client.notes || '') + `\n[${client.lastContact}] ${notes}`;
            }
            
            updateContractingClients();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم التحديث', `تم تحديث حالة العميل إلى "${getContractingStatusArabic(newStatus)}"`);
        }

        function addClientNotes(clientId) {
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-purple-700 mb-4">إضافة ملاحظات</h3>
                    
                    <div class="mb-4">
                        <p class="text-gray-700 mb-2"><strong>العميل:</strong> ${client.clientName}</p>
                        <p class="text-gray-700 mb-4"><strong>الخدمة:</strong> ${client.serviceTitle}</p>
                    </div>
                    
                    ${client.notes ? `
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg max-h-32 overflow-y-auto">
                        <h5 class="font-semibold text-gray-700 mb-2">الملاحظات السابقة:</h5>
                        <p class="text-sm text-gray-600 whitespace-pre-wrap">${client.notes}</p>
                    </div>
                    ` : ''}
                    
                    <form onsubmit="saveClientNotes(event, ${clientId})">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ملاحظة جديدة</label>
                            <textarea id="new-client-notes" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none h-24" placeholder="اكتب الملاحظة الجديدة..." required></textarea>
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">حفظ الملاحظة</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function saveClientNotes(event, clientId) {
            event.preventDefault();
            
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const newNote = document.getElementById('new-client-notes').value;
            const timestamp = new Date().toLocaleString('ar-EG');
            
            client.notes = (client.notes || '') + `\n[${timestamp}] ${newNote}`;
            client.lastContact = timestamp;
            
            updateContractingClients();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم الحفظ', 'تم حفظ الملاحظة بنجاح');
        }

        function viewContractingClientDetails(clientId) {
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-orange-700">تفاصيل عميل المقاولات</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <h4 class="font-bold text-orange-700 mb-3">معلومات العميل</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>الاسم:</strong> ${client.clientName}</p>
                                <p><strong>رقم الواتساب:</strong> ${client.whatsapp}</p>
                                <p><strong>تاريخ التسجيل:</strong> ${client.createdAt}</p>
                                <p><strong>المصدر:</strong> ${client.source === 'website' ? 'الموقع الإلكتروني' : 'إدخال يدوي'}</p>
                                ${client.lastContact ? `<p><strong>آخر تواصل:</strong> ${client.lastContact}</p>` : ''}
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-700 mb-3">تفاصيل الخدمة</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>نوع الخدمة:</strong> ${client.serviceTitle}</p>
                                <p><strong>الفئة:</strong> ${client.serviceCategory}</p>
                                <p><strong>الحالة:</strong> 
                                    <span class="px-2 py-1 rounded-full text-xs font-semibold ${getContractingStatusBadgeClass(client.status)}">
                                        ${getContractingStatusArabic(client.status)}
                                    </span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg md:col-span-2">
                            <h4 class="font-bold text-gray-700 mb-3">تفاصيل المشروع</h4>
                            <p class="text-sm text-gray-600 whitespace-pre-wrap">${client.projectDetails}</p>
                        </div>
                        
                        ${client.notes ? `
                        <div class="bg-purple-50 p-4 rounded-lg md:col-span-2">
                            <h4 class="font-bold text-purple-700 mb-3">الملاحظات والمتابعة</h4>
                            <div class="max-h-32 overflow-y-auto">
                                <p class="text-sm text-gray-600 whitespace-pre-wrap">${client.notes}</p>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="flex gap-4 justify-center mt-6">
                        <button onclick="copyWhatsAppLink('${client.whatsapp}', 'contracting')" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">تواصل عبر واتساب</button>
                        <button onclick="updateContractingClientStatus(${client.id}); this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">تحديث الحالة</button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">إغلاق</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function editContractingClient(clientId) {
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            const modalDiv = document.createElement('div');
            modalDiv.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modalDiv.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full">
                    <h3 class="text-xl font-bold text-yellow-700 mb-4">تعديل بيانات العميل</h3>
                    
                    <form onsubmit="saveContractingClientEdit(event, ${clientId})">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">اسم العميل</label>
                            <input type="text" id="edit-client-name" value="${client.clientName}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">رقم الواتساب</label>
                            <input type="tel" id="edit-client-whatsapp" value="${client.whatsapp}" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">تفاصيل المشروع</label>
                            <textarea id="edit-client-details" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none h-24" required>${client.projectDetails}</textarea>
                        </div>
                        
                        <div class="flex gap-4 justify-end">
                            <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">إلغاء</button>
                            <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">حفظ التعديلات</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function saveContractingClientEdit(event, clientId) {
            event.preventDefault();
            
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            client.clientName = document.getElementById('edit-client-name').value;
            client.whatsapp = document.getElementById('edit-client-whatsapp').value;
            client.projectDetails = document.getElementById('edit-client-details').value;
            client.lastUpdated = new Date().toLocaleString('ar-EG');
            
            updateContractingClients();
            
            // Close modal
            event.target.closest('.fixed').remove();
            
            showCustomAlert('تم التحديث', 'تم تحديث بيانات العميل بنجاح');
        }

        function deleteContractingClient(clientId) {
            const client = contractingClients.find(c => c.id === clientId);
            if (!client) return;
            
            showCustomConfirm('حذف العميل', `هل أنت متأكد من حذف العميل "${client.clientName}"؟`, () => {
                contractingClients = contractingClients.filter(c => c.id !== clientId);
                updateContractingClients();
                showCustomAlert('تم الحذف', 'تم حذف العميل بنجاح');
            });
        }

        function exportContractingClients() {
            if (contractingClients.length === 0) {
                showCustomAlert('لا توجد بيانات', 'لا توجد عملاء مقاولات لتصديرها');
                return;
            }
            
            let csvContent = 'اسم العميل,رقم الواتساب,نوع الخدمة,الفئة,الحالة,تفاصيل المشروع,تاريخ التسجيل,المصدر\n';
            
            contractingClients.forEach(client => {
                csvContent += `"${client.clientName}","${client.whatsapp}","${client.serviceTitle}","${client.serviceCategory}","${getContractingStatusArabic(client.status)}","${client.projectDetails.replace(/"/g, '""')}","${client.createdAt}","${client.source === 'website' ? 'موقع' : 'يدوي'}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `عملاء_المقاولات_${new Date().toLocaleDateString('ar-EG')}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showCustomAlert('تم التصدير', 'تم تصدير بيانات عملاء المقاولات بنجاح');
        }

        function getContractingStatusArabic(status) {
            const statuses = {
                'pending': 'قيد المراجعة',
                'contacted': 'تم التواصل',
                'in-progress': 'قيد التنفيذ',
                'completed': 'مكتمل'
            };
            return statuses[status] || status;
        }

        function getContractingStatusBadgeClass(status) {
            const classes = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'contacted': 'bg-blue-100 text-blue-800',
                'in-progress': 'bg-orange-100 text-orange-800',
                'completed': 'bg-green-100 text-green-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        // Initialize with home section
        showSection('home');
        
        // Initialize location counts
        setTimeout(() => {
            updateLocationCounts();
            updateServicesList();
            updateHomeServices();
            updateContractingClients();
        }, 100);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'992a775781bae28e',t:'MTc2MTE1MTUzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
